import { mapJwaSignatureAlgorithmToNode } from "./sign.mjs";
import { Kms, TypedArrayEncoder } from "@credo-ts/core";
import { constants, createHmac, createPublicKey, createSecretKey, timingSafeEqual, verify } from "node:crypto";
import { promisify } from "node:util";
import { Buffer } from "node:buffer";

//#region src/kms/crypto/verify.ts
const verify$1 = promisify(verify);
function performVerify(key, algorithm, data, signature) {
	const nodeAlgorithm = mapJwaSignatureAlgorithmToNode(algorithm);
	const nodeKey = key.kty === "oct" ? createSecretKey(TypedArrayEncoder.fromBase64(key.k)) : createPublicKey({
		format: "jwk",
		key
	});
	switch (key.kty) {
		case "RSA":
		case "OKP": return verify$1(nodeAlgorithm, data, algorithm.startsWith("PS") ? {
			key: nodeKey,
			padding: constants.RSA_PKCS1_PSS_PADDING,
			saltLength: Number.parseInt(algorithm.slice(2), 10) / 8
		} : nodeKey, signature);
		case "EC": return verify$1(nodeAlgorithm, data, nodeKey, Kms.rawEcSignatureToDer(signature, key.crv));
		case "oct": return timingSafeEqual(createHmac(nodeAlgorithm, nodeKey).update(data).digest(), Buffer.from(signature));
		default: throw new Kms.KeyManagementAlgorithmNotSupportedError(`kty '${key.kty}'`, "node");
	}
}

//#endregion
export { performVerify };
//# sourceMappingURL=verify.mjs.map