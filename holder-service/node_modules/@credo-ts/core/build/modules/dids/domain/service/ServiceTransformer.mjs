

import { JsonTransformer } from "../../../../utils/JsonTransformer.mjs";
import "../../../../utils/index.mjs";
import { DidDocumentService } from "./DidDocumentService.mjs";
import { DidCommV1Service } from "./DidCommV1Service.mjs";
import { DidCommV2Service } from "./DidCommV2Service.mjs";
import { IndyAgentService } from "./IndyAgentService.mjs";
import { LegacyDidCommV2Service } from "./LegacyDidCommV2Service.mjs";
import { Transform } from "class-transformer";

//#region src/modules/dids/domain/service/ServiceTransformer.ts
const serviceTypes = {
	[IndyAgentService.type]: IndyAgentService,
	[DidCommV1Service.type]: DidCommV1Service,
	[DidCommV2Service.type]: DidCommV2Service,
	[LegacyDidCommV2Service.type]: LegacyDidCommV2Service
};
/**
* Decorator that transforms service json to corresponding class instances. See {@link serviceTypes}
*
* @example
* class Example {
*   ServiceTransformer()
*   private service: Service
* }
*/
function ServiceTransformer() {
	return Transform(({ value }) => {
		return value?.map((serviceJson) => {
			let serviceClass = serviceTypes[serviceJson.type] ?? DidDocumentService;
			if (serviceJson.type === DidCommV2Service.type && "serviceEndpoint" in serviceJson && typeof serviceJson.serviceEndpoint === "string") serviceClass = LegacyDidCommV2Service;
			return JsonTransformer.fromJSON(serviceJson, serviceClass);
		});
	}, { toClassOnly: true });
}

//#endregion
export { ServiceTransformer, serviceTypes };
//# sourceMappingURL=ServiceTransformer.mjs.map