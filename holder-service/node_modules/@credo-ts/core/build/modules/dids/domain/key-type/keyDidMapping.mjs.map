{"version":3,"file":"keyDidMapping.mjs","names":[],"sources":["../../../../../src/modules/dids/domain/key-type/keyDidMapping.ts"],"sourcesContent":["import { CredoError } from '../../../../error'\nimport type { Constructor } from '../../../../utils/mixins'\nimport { PublicJwk } from '../../../kms'\nimport type { SupportedPublicJwkClass } from '../../../kms/jwk/PublicJwk'\nimport type { VerificationMethod } from '../verificationMethod'\nimport { getPublicJwkFromMultikey, isMultikey } from '../verificationMethod'\nimport { getPublicJwkFromJsonWebKey2020, isJsonWebKey2020 } from '../verificationMethod/JsonWebKey2020'\nimport { keyDidEd25519 } from './ed25519'\nimport { keyDidJsonWebKey } from './keyDidJsonWebKey'\nimport { keyDidSecp256k1 } from './secp256k1'\nimport { keyDidX25519 } from './x25519'\n\nexport interface KeyDidMapping<\n  PublicJwkType extends InstanceType<SupportedPublicJwkClass> = InstanceType<SupportedPublicJwkClass>,\n> {\n  PublicJwkTypes: Array<Constructor<PublicJwkType>>\n  getVerificationMethods: (did: string, publicJwk: PublicJwk<PublicJwkType>) => VerificationMethod[]\n  getPublicJwkFromVerificationMethod(verificationMethod: VerificationMethod): PublicJwk\n  supportedVerificationMethodTypes: string[]\n}\n\nconst supportedKeyDids = [keyDidEd25519, keyDidX25519, keyDidJsonWebKey, keyDidSecp256k1]\n\n// TODO: at some point we should update all usages to Jwk / Multikey methods\n// so we don't need key type specific verification methods anymore\nexport function getVerificationMethodsForPublicJwk(publicJwk: PublicJwk, did: string) {\n  const { getVerificationMethods } = getKeyDidMappingByPublicJwk(publicJwk)\n\n  return getVerificationMethods(did, publicJwk)\n}\n\nexport function getSupportedVerificationMethodTypesForPublicJwk(\n  publicJwk: PublicJwk | SupportedPublicJwkClass\n): string[] {\n  const { supportedVerificationMethodTypes } = getKeyDidMappingByPublicJwk(publicJwk)\n\n  return supportedVerificationMethodTypes\n}\n\nexport function getPublicJwkFromVerificationMethod(verificationMethod: VerificationMethod): PublicJwk {\n  // This is a special verification method, as it supports basically all key types.\n  if (isJsonWebKey2020(verificationMethod)) {\n    return getPublicJwkFromJsonWebKey2020(verificationMethod)\n  }\n\n  if (isMultikey(verificationMethod)) {\n    return getPublicJwkFromMultikey(verificationMethod)\n  }\n\n  const keyDid = supportedKeyDids.find((keyDid) =>\n    keyDid.supportedVerificationMethodTypes.includes(verificationMethod.type)\n  )\n  if (!keyDid) {\n    throw new CredoError(`Unsupported key did from verification method type '${verificationMethod.type}'`)\n  }\n\n  return keyDid.getPublicJwkFromVerificationMethod(verificationMethod)\n}\n\nfunction getKeyDidMappingByPublicJwk(jwk: PublicJwk | SupportedPublicJwkClass): KeyDidMapping {\n  const jwkTypeClass = jwk instanceof PublicJwk ? jwk.JwkClass : jwk\n\n  const keyDid = supportedKeyDids.find((supportedKeyDid) =>\n    // biome-ignore lint/suspicious/noExplicitAny: no explanation\n    supportedKeyDid.PublicJwkTypes.includes(jwkTypeClass as any)\n  )\n\n  if (!keyDid) {\n    throw new CredoError(\n      `Unsupported did mapping for jwk '${jwk instanceof PublicJwk ? jwk.jwkTypeHumanDescription : jwk.name}'`\n    )\n  }\n\n  return keyDid as KeyDidMapping\n}\n"],"mappings":";;;;;;;;;;;;;;;AAqBA,MAAM,mBAAmB;CAAC;CAAe;CAAc;CAAkB;CAAgB;AAIzF,SAAgB,mCAAmC,WAAsB,KAAa;CACpF,MAAM,EAAE,2BAA2B,4BAA4B,UAAU;AAEzE,QAAO,uBAAuB,KAAK,UAAU;;AAG/C,SAAgB,gDACd,WACU;CACV,MAAM,EAAE,qCAAqC,4BAA4B,UAAU;AAEnF,QAAO;;AAGT,SAAgB,mCAAmC,oBAAmD;AAEpG,KAAI,iBAAiB,mBAAmB,CACtC,QAAO,+BAA+B,mBAAmB;AAG3D,KAAI,WAAW,mBAAmB,CAChC,QAAO,yBAAyB,mBAAmB;CAGrD,MAAM,SAAS,iBAAiB,MAAM,WACpC,OAAO,iCAAiC,SAAS,mBAAmB,KAAK,CAC1E;AACD,KAAI,CAAC,OACH,OAAM,IAAI,WAAW,sDAAsD,mBAAmB,KAAK,GAAG;AAGxG,QAAO,OAAO,mCAAmC,mBAAmB;;AAGtE,SAAS,4BAA4B,KAAyD;CAC5F,MAAM,eAAe,eAAe,YAAY,IAAI,WAAW;CAE/D,MAAM,SAAS,iBAAiB,MAAM,oBAEpC,gBAAgB,eAAe,SAAS,aAAoB,CAC7D;AAED,KAAI,CAAC,OACH,OAAM,IAAI,WACR,oCAAoC,eAAe,YAAY,IAAI,0BAA0B,IAAI,KAAK,GACvG;AAGH,QAAO"}