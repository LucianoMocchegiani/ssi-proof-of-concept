{"version":3,"file":"DidCommModuleConfig.mjs","names":[],"sources":["../src/DidCommModuleConfig.ts"],"sourcesContent":["import { DID_COMM_TRANSPORT_QUEUE } from './constants'\nimport type {\n  DidCommConnectionsModuleConfigOptions,\n  DidCommCredentialProtocol,\n  DidCommMessagePickupModuleConfigOptions,\n  DidCommMessagePickupProtocol,\n  DidCommProofsModuleConfigOptions,\n} from './modules'\nimport type { DidCommCredentialsModuleConfigOptions } from './modules/credentials/DidCommCredentialsModuleConfig'\nimport type { DidCommDiscoverFeaturesModuleConfigOptions } from './modules/discover-features/DidCommDiscoverFeaturesModuleConfig'\nimport type { DidCommProofProtocol } from './modules/proofs/protocol/DidCommProofProtocol'\nimport type { DidCommMediationRecipientModuleConfigOptions } from './modules/routing/DidCommMediationRecipientModuleConfig'\nimport type { DidCommMediatorModuleConfigOptions } from './modules/routing/DidCommMediatorModuleConfig'\nimport {\n  type DidCommInboundTransport,\n  type DidCommOutboundTransport,\n  type DidCommQueueTransportRepository,\n  InMemoryQueueTransportRepository,\n} from './transport'\nimport { DidCommMimeType } from './types'\n\nexport interface DidCommModuleConfigOptions {\n  endpoints?: string[]\n  transports?: {\n    inbound?: DidCommInboundTransport[]\n    outbound?: DidCommOutboundTransport[]\n  }\n  useDidSovPrefixWhereAllowed?: boolean\n  processDidCommMessagesConcurrently?: boolean\n  didCommMimeType?: string\n  useDidKeyInProtocols?: boolean\n  queueTransportRepository?: DidCommQueueTransportRepository\n\n  /**\n   * Configuration for the connection module.\n   *\n   * The connection module is always enabled\n   */\n  connections?: DidCommConnectionsModuleConfigOptions\n\n  /**\n   * Configuration for the discover features module.\n   *\n   * The discover features module is always enabled\n   */\n  discovery?: DidCommDiscoverFeaturesModuleConfigOptions\n\n  /**\n   * Configuration for the credentials module\n   *\n   * The credentials module is enabled by default with\n   * the V2ProofsProtocol and the XProofFormatService\n   *\n   * You can disable the module by passing `false`, or provide a\n   * custom configuration to override the default\n   *\n   * @default true\n   */\n  credentials?: boolean | DidCommCredentialsModuleConfigOptions<DidCommCredentialProtocol[]>\n\n  /**\n   * Configuration for the proofs module\n   *\n   * The proofs module is enabled by default with\n   * the V2CredentialsProtocol and the XXCredentialFormatService\n   *\n   * You can disable the module by passing `false`, or provide a\n   * custom configuration to override the default\n   *\n   * @default true\n   */\n  proofs?: boolean | DidCommProofsModuleConfigOptions<DidCommProofProtocol[]>\n\n  /**\n   * Configuration to enable to basic messages module\n   *\n   * The basic messages module is enabled by default,\n   * but can be disabled by passing `false`\n   *\n   * @default true\n   */\n  basicMessages?: boolean\n\n  /**\n   * Configuration for the message pickup module\n   *\n   * The message pickup module is enabled by default with\n   * the V1PickupProtocol and the V2PickupProtocol\n   *\n   * You can disable the module by passing `false`, or provide a\n   * custom configuration to override the default\n   *\n   * @default true\n   */\n  messagePickup?: boolean | DidCommMessagePickupModuleConfigOptions<DidCommMessagePickupProtocol[]>\n\n  /**\n   * Configuration or the mediator module\n   *\n   * The mediator module is enabled by default,\n   * but can be disabled by passing `false`\n   *\n   * @default true\n   */\n  mediator?: boolean | DidCommMediatorModuleConfigOptions\n\n  /**\n   * Configuration for the mediation recipient module\n   *\n   * The mediator module is enabled by default,\n   * but can be disabled by passing `false`\n   *\n   * @default true\n   */\n  mediationRecipient?: boolean | DidCommMediationRecipientModuleConfigOptions\n}\n\nexport class DidCommModuleConfig<Options extends DidCommModuleConfigOptions = DidCommModuleConfigOptions> {\n  private options: Options\n  private _endpoints?: string[]\n  private _inboundTransports: DidCommInboundTransport[]\n  private _outboundTransports: DidCommOutboundTransport[]\n  private _queueTransportRepository: DidCommQueueTransportRepository\n\n  public readonly enabledModules: {\n    oob: true\n    connections: true\n    discovery: true\n    credentials: Options['credentials'] extends false ? false : true\n    proofs: Options['proofs'] extends false ? false : true\n    messagePickup: Options['messagePickup'] extends false ? false : true\n    mediator: Options['mediator'] extends false ? false : true\n    mediationRecipient: Options['mediationRecipient'] extends false ? false : true\n    basicMessages: Options['basicMessages'] extends false ? false : true\n  }\n\n  public constructor(options?: Options) {\n    this.options = (options ?? {}) as Options\n    this._endpoints = options?.endpoints\n    this._inboundTransports = options?.transports?.inbound ?? []\n    this._outboundTransports = options?.transports?.outbound ?? []\n    this._queueTransportRepository = options?.queueTransportRepository ?? new InMemoryQueueTransportRepository()\n\n    this.enabledModules = {\n      connections: true,\n      oob: true,\n      discovery: true,\n      proofs: this.options.proofs !== false,\n      credentials: this.options.credentials !== false,\n      messagePickup: this.options.messagePickup !== false,\n      mediator: this.options.mediator !== false,\n      mediationRecipient: this.options.mediationRecipient !== false,\n      basicMessages: this.options.basicMessages !== false,\n    } as this['enabledModules']\n  }\n\n  public get endpoints(): [string, ...string[]] {\n    // if endpoints is not set, return queue endpoint\n    // https://github.com/hyperledger/aries-rfcs/issues/405#issuecomment-582612875\n    if (!this._endpoints || this._endpoints.length === 0) {\n      return [DID_COMM_TRANSPORT_QUEUE]\n    }\n\n    return this._endpoints as [string, ...string[]]\n  }\n\n  public set endpoints(endpoints: string[]) {\n    this._endpoints = endpoints\n  }\n\n  public get useDidSovPrefixWhereAllowed() {\n    return this.options.useDidSovPrefixWhereAllowed ?? false\n  }\n\n  public get inboundTransports() {\n    return this._inboundTransports\n  }\n\n  public set inboundTransports(inboundTransports: DidCommInboundTransport[]) {\n    this._inboundTransports = inboundTransports\n  }\n\n  public get outboundTransports() {\n    return this._outboundTransports\n  }\n\n  public set outboundTransports(outboundTransports: DidCommOutboundTransport[]) {\n    this._outboundTransports = outboundTransports\n  }\n\n  public get processDidCommMessagesConcurrently() {\n    return this.options.processDidCommMessagesConcurrently ?? false\n  }\n\n  public get didCommMimeType() {\n    return this.options.didCommMimeType ?? DidCommMimeType.V1\n  }\n\n  /**\n   * Encode keys in did:key format instead of 'naked' keys, as stated in Aries RFC 0360.\n   *\n   * This setting will not be taken into account if the other party has previously used naked keys\n   * in a given protocol (i.e. it does not support Aries RFC 0360).\n   */\n  public get useDidKeyInProtocols() {\n    return this.options.useDidKeyInProtocols ?? true\n  }\n\n  /**\n   * Allows to specify a custom queue transport queue. It defaults to an in-memory queue\n   *\n   */\n  public get queueTransportRepository() {\n    return this._queueTransportRepository\n  }\n}\n"],"mappings":";;;;;;AAqHA,IAAa,sBAAb,MAA0G;CAmBxG,AAAO,YAAY,SAAmB;AACpC,OAAK,UAAW,WAAW,EAAE;AAC7B,OAAK,aAAa,SAAS;AAC3B,OAAK,qBAAqB,SAAS,YAAY,WAAW,EAAE;AAC5D,OAAK,sBAAsB,SAAS,YAAY,YAAY,EAAE;AAC9D,OAAK,4BAA4B,SAAS,4BAA4B,IAAI,kCAAkC;AAE5G,OAAK,iBAAiB;GACpB,aAAa;GACb,KAAK;GACL,WAAW;GACX,QAAQ,KAAK,QAAQ,WAAW;GAChC,aAAa,KAAK,QAAQ,gBAAgB;GAC1C,eAAe,KAAK,QAAQ,kBAAkB;GAC9C,UAAU,KAAK,QAAQ,aAAa;GACpC,oBAAoB,KAAK,QAAQ,uBAAuB;GACxD,eAAe,KAAK,QAAQ,kBAAkB;GAC/C;;CAGH,IAAW,YAAmC;AAG5C,MAAI,CAAC,KAAK,cAAc,KAAK,WAAW,WAAW,EACjD,QAAO,CAAC,yBAAyB;AAGnC,SAAO,KAAK;;CAGd,IAAW,UAAU,WAAqB;AACxC,OAAK,aAAa;;CAGpB,IAAW,8BAA8B;AACvC,SAAO,KAAK,QAAQ,+BAA+B;;CAGrD,IAAW,oBAAoB;AAC7B,SAAO,KAAK;;CAGd,IAAW,kBAAkB,mBAA8C;AACzE,OAAK,qBAAqB;;CAG5B,IAAW,qBAAqB;AAC9B,SAAO,KAAK;;CAGd,IAAW,mBAAmB,oBAAgD;AAC5E,OAAK,sBAAsB;;CAG7B,IAAW,qCAAqC;AAC9C,SAAO,KAAK,QAAQ,sCAAsC;;CAG5D,IAAW,kBAAkB;AAC3B,SAAO,KAAK,QAAQ,mBAAmB,gBAAgB;;;;;;;;CASzD,IAAW,uBAAuB;AAChC,SAAO,KAAK,QAAQ,wBAAwB;;;;;;CAO9C,IAAW,2BAA2B;AACpC,SAAO,KAAK"}