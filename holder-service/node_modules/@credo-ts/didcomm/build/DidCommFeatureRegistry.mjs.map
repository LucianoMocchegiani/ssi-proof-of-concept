{"version":3,"file":"DidCommFeatureRegistry.mjs","names":[],"sources":["../src/DidCommFeatureRegistry.ts"],"sourcesContent":["import { injectable } from '@credo-ts/core'\nimport type { DidCommFeature, DidCommFeatureQuery } from './models'\n\n@injectable()\nexport class DidCommFeatureRegistry {\n  private features: DidCommFeature[] = []\n\n  /**\n   * Register a single or set of Features on the registry\n   *\n   * @param features set of {Feature} objects or any inherited class\n   */\n  public register(...features: DidCommFeature[]) {\n    for (const feature of features) {\n      const index = this.features.findIndex((item) => item.type === feature.type && item.id === feature.id)\n\n      if (index > -1) {\n        this.features[index] = this.features[index].combine(feature)\n      } else {\n        this.features.push(feature)\n      }\n    }\n  }\n\n  /**\n   * Perform a set of queries in the registry, supporting wildcards (*) as\n   * expressed in Aries RFC 0557.\n   *\n   * @see https://github.com/hyperledger/aries-rfcs/blob/560ffd23361f16a01e34ccb7dcc908ec28c5ddb1/features/0557-discover-features-v2/README.md\n   *\n   * @param queries set of {FeatureQuery} objects to query features\n   * @returns array containing all matching features (can be empty)\n   */\n  public query(...queries: DidCommFeatureQuery[]) {\n    const output = []\n    for (const query of queries) {\n      const items = this.features.filter((item) => item.type === query.featureType)\n      // An * will return all features of a given type (e.g. all protocols, all goal codes, all AIP configs)\n      if (query.match === '*') {\n        output.push(...items)\n        // An string ending with * will return a family of features of a certain type\n        // (e.g. all versions of a given protocol, all subsets of an AIP, etc.)\n      } else if (query.match.endsWith('*')) {\n        const match = query.match.slice(0, -1)\n        output.push(...items.filter((m) => m.id.startsWith(match)))\n        // Exact matching (single feature)\n      } else {\n        output.push(...items.filter((m) => m.id === query.match))\n      }\n    }\n    return output\n  }\n}\n"],"mappings":";;;;AAIO,mCAAM,uBAAuB;;OAC1B,WAA6B,EAAE;;;;;;;CAOvC,AAAO,SAAS,GAAG,UAA4B;AAC7C,OAAK,MAAM,WAAW,UAAU;GAC9B,MAAM,QAAQ,KAAK,SAAS,WAAW,SAAS,KAAK,SAAS,QAAQ,QAAQ,KAAK,OAAO,QAAQ,GAAG;AAErG,OAAI,QAAQ,GACV,MAAK,SAAS,SAAS,KAAK,SAAS,OAAO,QAAQ,QAAQ;OAE5D,MAAK,SAAS,KAAK,QAAQ;;;;;;;;;;;;CAcjC,AAAO,MAAM,GAAG,SAAgC;EAC9C,MAAM,SAAS,EAAE;AACjB,OAAK,MAAM,SAAS,SAAS;GAC3B,MAAM,QAAQ,KAAK,SAAS,QAAQ,SAAS,KAAK,SAAS,MAAM,YAAY;AAE7E,OAAI,MAAM,UAAU,IAClB,QAAO,KAAK,GAAG,MAAM;YAGZ,MAAM,MAAM,SAAS,IAAI,EAAE;IACpC,MAAM,QAAQ,MAAM,MAAM,MAAM,GAAG,GAAG;AACtC,WAAO,KAAK,GAAG,MAAM,QAAQ,MAAM,EAAE,GAAG,WAAW,MAAM,CAAC,CAAC;SAG3D,QAAO,KAAK,GAAG,MAAM,QAAQ,MAAM,EAAE,OAAO,MAAM,MAAM,CAAC;;AAG7D,SAAO;;;qCA/CV,YAAY"}