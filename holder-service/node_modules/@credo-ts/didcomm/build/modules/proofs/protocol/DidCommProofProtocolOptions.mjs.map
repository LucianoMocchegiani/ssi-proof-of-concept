{"version":3,"file":"DidCommProofProtocolOptions.mjs","names":[],"sources":["../../../../src/modules/proofs/protocol/DidCommProofProtocolOptions.ts"],"sourcesContent":["import type { DidCommMessage } from '../../../DidCommMessage'\nimport type { DidCommConnectionRecord } from '../../connections'\nimport type {\n  DidCommProofFormat,\n  DidCommProofFormatCredentialForRequestPayload,\n  DidCommProofFormatPayload,\n  DidCommProofFormatService,\n  ExtractProofFormats,\n} from '../formats'\nimport type { DidCommAutoAcceptProof } from '../models'\nimport type { DidCommProofExchangeRecord } from '../repository'\nimport type { DidCommProofProtocol } from './DidCommProofProtocol'\n\n/**\n * Get the format data payload for a specific message from a list of ProofFormat interfaces and a message\n *\n * For an indy offer, this resolves to the proof request format as defined here:\n * https://github.com/hyperledger/aries-rfcs/tree/b3a3942ef052039e73cd23d847f42947f8287da2/features/0592-indy-attachments#proof-request-format\n *\n * @example\n * ```\n *\n * type RequestFormatData = ProofFormatDataMessagePayload<[IndyProofFormat, PresentationExchangeProofFormat], 'createRequest'>\n *\n * // equal to\n * type RequestFormatData = {\n *  indy: {\n *   // ... payload for indy proof request attachment as defined in RFC 0592 ...\n *  },\n *  presentationExchange: {\n *   // ... payload for presentation exchange request attachment as defined in RFC 0510 ...\n *  }\n * }\n * ```\n */\nexport type ProofFormatDataMessagePayload<\n  CFs extends DidCommProofFormat[] = DidCommProofFormat[],\n  M extends keyof DidCommProofFormat['formatData'] = keyof DidCommProofFormat['formatData'],\n> = {\n  [ProofFormat in CFs[number] as ProofFormat['formatKey']]?: ProofFormat['formatData'][M]\n}\n\n/**\n * Infer the {@link DidCommProofFormat} types based on an array of {@link DidCommProofProtocol} types.\n *\n * It does this by extracting the `ProofFormatServices` generic from the `DidCommProofProtocol`, and\n * then extracting the `ProofFormat` generic from each of the `ProofFormatService` types.\n *\n * @example\n * ```\n * // TheProofFormatServices is now equal to [IndyProofFormatService]\n * type TheProofFormatServices = ProofFormatsFromProtocols<[DidCommProofV1Protocol]>\n * ```\n *\n * Because the `DidCommProofV1Protocol` is defined as follows:\n * ```\n * class DidCommProofV1Protocol implements DidCommProofProtocol<[IndyProofFormatService]> {\n * }\n * ```\n */\nexport type ProofFormatsFromProtocols<Type extends DidCommProofProtocol[]> =\n  Type[number] extends DidCommProofProtocol<infer ProofFormatServices>\n    ? ProofFormatServices extends DidCommProofFormatService[]\n      ? ExtractProofFormats<ProofFormatServices>\n      : never\n    : never\n\nexport type GetProofFormatDataReturn<PFs extends DidCommProofFormat[] = DidCommProofFormat[]> = {\n  proposal?: ProofFormatDataMessagePayload<PFs, 'proposal'>\n  request?: ProofFormatDataMessagePayload<PFs, 'request'>\n  presentation?: ProofFormatDataMessagePayload<PFs, 'presentation'>\n}\n\ninterface BaseOptions {\n  comment?: string\n  autoAcceptProof?: DidCommAutoAcceptProof\n\n  /**\n   * Will be ignored for v1 protocol as it is not supported\n   */\n  goalCode?: string\n\n  /**\n   * Will be ignored for v1 protocol as it is not supported\n   */\n  goal?: string\n}\n\nexport interface CreateProofProposalOptions<PFs extends DidCommProofFormatService[]> extends BaseOptions {\n  connectionRecord?: DidCommConnectionRecord\n  proofFormats: DidCommProofFormatPayload<ExtractProofFormats<PFs>, 'createProposal'>\n  parentThreadId?: string\n}\n\nexport interface AcceptProofProposalOptions<PFs extends DidCommProofFormatService[]> extends BaseOptions {\n  proofRecord: DidCommProofExchangeRecord\n  proofFormats?: DidCommProofFormatPayload<ExtractProofFormats<PFs>, 'acceptProposal'>\n\n  /** @default true */\n  willConfirm?: boolean\n}\n\nexport interface NegotiateProofProposalOptions<PFs extends DidCommProofFormatService[]> extends BaseOptions {\n  proofRecord: DidCommProofExchangeRecord\n  proofFormats: DidCommProofFormatPayload<ExtractProofFormats<PFs>, 'createRequest'>\n\n  /** @default true */\n  willConfirm?: boolean\n}\n\nexport interface CreateProofRequestOptions<PFs extends DidCommProofFormatService[]> extends BaseOptions {\n  // Create request can also be used for connection-less, so connection is optional\n  connectionRecord?: DidCommConnectionRecord\n  proofFormats: DidCommProofFormatPayload<ExtractProofFormats<PFs>, 'createRequest'>\n  parentThreadId?: string\n\n  /** @default true */\n  willConfirm?: boolean\n}\n\nexport interface AcceptProofRequestOptions<PFs extends DidCommProofFormatService[]> extends BaseOptions {\n  proofRecord: DidCommProofExchangeRecord\n  proofFormats?: DidCommProofFormatPayload<ExtractProofFormats<PFs>, 'acceptRequest'>\n}\n\nexport interface NegotiateProofRequestOptions<PFs extends DidCommProofFormatService[]> extends BaseOptions {\n  proofRecord: DidCommProofExchangeRecord\n  proofFormats: DidCommProofFormatPayload<ExtractProofFormats<PFs>, 'createProposal'>\n}\n\nexport interface GetCredentialsForRequestOptions<PFs extends DidCommProofFormatService[]> {\n  proofRecord: DidCommProofExchangeRecord\n  proofFormats?: DidCommProofFormatCredentialForRequestPayload<\n    ExtractProofFormats<PFs>,\n    'getCredentialsForRequest',\n    'input'\n  >\n}\n\nexport interface GetCredentialsForRequestReturn<PFs extends DidCommProofFormatService[]> {\n  proofFormats: DidCommProofFormatCredentialForRequestPayload<\n    ExtractProofFormats<PFs>,\n    'getCredentialsForRequest',\n    'output'\n  >\n}\n\nexport interface SelectCredentialsForRequestOptions<PFs extends DidCommProofFormatService[]> {\n  proofRecord: DidCommProofExchangeRecord\n  proofFormats?: DidCommProofFormatCredentialForRequestPayload<\n    ExtractProofFormats<PFs>,\n    'selectCredentialsForRequest',\n    'input'\n  >\n}\n\nexport interface SelectCredentialsForRequestReturn<PFs extends DidCommProofFormatService[]> {\n  proofFormats: DidCommProofFormatCredentialForRequestPayload<\n    ExtractProofFormats<PFs>,\n    'selectCredentialsForRequest',\n    'output'\n  >\n}\n\nexport interface AcceptPresentationOptions {\n  proofRecord: DidCommProofExchangeRecord\n}\n\nexport interface CreateProofProblemReportOptions {\n  proofRecord: DidCommProofExchangeRecord\n  description: string\n}\n\nexport interface ProofProtocolMsgReturnType<MessageType extends DidCommMessage> {\n  message: MessageType\n  proofRecord: DidCommProofExchangeRecord\n}\n\nexport interface DeleteProofOptions {\n  deleteAssociatedDidCommMessages?: boolean\n}\n"],"mappings":""}