{"version":3,"file":"DidCommRequestPresentationV2Handler.mjs","names":[],"sources":["../../../../../../src/modules/proofs/protocol/v2/handlers/DidCommRequestPresentationV2Handler.ts"],"sourcesContent":["import { getOutboundDidCommMessageContext } from '../../../../../getDidCommOutboundMessageContext'\nimport type { DidCommMessageHandler, DidCommMessageHandlerInboundMessage } from '../../../../../handlers'\nimport type { DidCommProofExchangeRecord } from '../../../repository/DidCommProofExchangeRecord'\nimport type { DidCommProofV2Protocol } from '../DidCommProofV2Protocol'\nimport { DidCommRequestPresentationV2Message } from '../messages/DidCommRequestPresentationV2Message'\n\nexport class DidCommRequestPresentationV2Handler implements DidCommMessageHandler {\n  private proofProtocol: DidCommProofV2Protocol\n  public supportedMessages = [DidCommRequestPresentationV2Message]\n\n  public constructor(proofProtocol: DidCommProofV2Protocol) {\n    this.proofProtocol = proofProtocol\n  }\n\n  public async handle(messageContext: DidCommMessageHandlerInboundMessage<DidCommRequestPresentationV2Handler>) {\n    const proofRecord = await this.proofProtocol.processRequest(messageContext)\n\n    const shouldAutoRespond = await this.proofProtocol.shouldAutoRespondToRequest(messageContext.agentContext, {\n      proofRecord,\n      requestMessage: messageContext.message,\n    })\n\n    messageContext.agentContext.config.logger.debug(`Should auto respond to request: ${shouldAutoRespond}`)\n\n    if (shouldAutoRespond) {\n      return await this.acceptRequest(proofRecord, messageContext)\n    }\n  }\n\n  private async acceptRequest(\n    proofRecord: DidCommProofExchangeRecord,\n    messageContext: DidCommMessageHandlerInboundMessage<DidCommRequestPresentationV2Handler>\n  ) {\n    messageContext.agentContext.config.logger.info('Automatically sending presentation with autoAccept')\n\n    const { message } = await this.proofProtocol.acceptRequest(messageContext.agentContext, {\n      proofRecord,\n    })\n\n    return getOutboundDidCommMessageContext(messageContext.agentContext, {\n      message,\n      lastReceivedMessage: messageContext.message,\n      associatedRecord: proofRecord,\n      connectionRecord: messageContext.connection,\n    })\n  }\n}\n"],"mappings":";;;;AAMA,IAAa,sCAAb,MAAkF;CAIhF,AAAO,YAAY,eAAuC;OAFnD,oBAAoB,CAAC,oCAAoC;AAG9D,OAAK,gBAAgB;;CAGvB,MAAa,OAAO,gBAA0F;EAC5G,MAAM,cAAc,MAAM,KAAK,cAAc,eAAe,eAAe;EAE3E,MAAM,oBAAoB,MAAM,KAAK,cAAc,2BAA2B,eAAe,cAAc;GACzG;GACA,gBAAgB,eAAe;GAChC,CAAC;AAEF,iBAAe,aAAa,OAAO,OAAO,MAAM,mCAAmC,oBAAoB;AAEvG,MAAI,kBACF,QAAO,MAAM,KAAK,cAAc,aAAa,eAAe;;CAIhE,MAAc,cACZ,aACA,gBACA;AACA,iBAAe,aAAa,OAAO,OAAO,KAAK,qDAAqD;EAEpG,MAAM,EAAE,YAAY,MAAM,KAAK,cAAc,cAAc,eAAe,cAAc,EACtF,aACD,CAAC;AAEF,SAAO,iCAAiC,eAAe,cAAc;GACnE;GACA,qBAAqB,eAAe;GACpC,kBAAkB;GAClB,kBAAkB,eAAe;GAClC,CAAC"}