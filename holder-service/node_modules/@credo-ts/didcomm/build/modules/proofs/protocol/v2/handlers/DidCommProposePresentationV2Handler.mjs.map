{"version":3,"file":"DidCommProposePresentationV2Handler.mjs","names":[],"sources":["../../../../../../src/modules/proofs/protocol/v2/handlers/DidCommProposePresentationV2Handler.ts"],"sourcesContent":["import type { DidCommMessageHandler, DidCommMessageHandlerInboundMessage } from '../../../../../handlers'\nimport { DidCommOutboundMessageContext } from '../../../../../models'\nimport type { DidCommProofExchangeRecord } from '../../../repository/DidCommProofExchangeRecord'\nimport type { DidCommProofV2Protocol } from '../DidCommProofV2Protocol'\nimport { DidCommProposePresentationV2Message } from '../messages/DidCommProposePresentationV2Message'\n\nexport class DidCommProposePresentationV2Handler implements DidCommMessageHandler {\n  private proofProtocol: DidCommProofV2Protocol\n  public supportedMessages = [DidCommProposePresentationV2Message]\n\n  public constructor(proofProtocol: DidCommProofV2Protocol) {\n    this.proofProtocol = proofProtocol\n  }\n\n  public async handle(messageContext: DidCommMessageHandlerInboundMessage<DidCommProposePresentationV2Handler>) {\n    const proofRecord = await this.proofProtocol.processProposal(messageContext)\n\n    const shouldAutoRespond = await this.proofProtocol.shouldAutoRespondToProposal(messageContext.agentContext, {\n      proofRecord,\n      proposalMessage: messageContext.message,\n    })\n\n    if (shouldAutoRespond) {\n      return this.acceptProposal(proofRecord, messageContext)\n    }\n  }\n  private async acceptProposal(\n    proofRecord: DidCommProofExchangeRecord,\n    messageContext: DidCommMessageHandlerInboundMessage<DidCommProposePresentationV2Handler>\n  ) {\n    messageContext.agentContext.config.logger.info('Automatically sending request with autoAccept')\n\n    if (!messageContext.connection) {\n      messageContext.agentContext.config.logger.error('No connection on the messageContext, aborting auto accept')\n      return\n    }\n\n    const { message } = await this.proofProtocol.acceptProposal(messageContext.agentContext, { proofRecord })\n\n    return new DidCommOutboundMessageContext(message, {\n      agentContext: messageContext.agentContext,\n      connection: messageContext.connection,\n      associatedRecord: proofRecord,\n    })\n  }\n}\n"],"mappings":";;;;;AAMA,IAAa,sCAAb,MAAkF;CAIhF,AAAO,YAAY,eAAuC;OAFnD,oBAAoB,CAAC,oCAAoC;AAG9D,OAAK,gBAAgB;;CAGvB,MAAa,OAAO,gBAA0F;EAC5G,MAAM,cAAc,MAAM,KAAK,cAAc,gBAAgB,eAAe;AAO5E,MAL0B,MAAM,KAAK,cAAc,4BAA4B,eAAe,cAAc;GAC1G;GACA,iBAAiB,eAAe;GACjC,CAAC,CAGA,QAAO,KAAK,eAAe,aAAa,eAAe;;CAG3D,MAAc,eACZ,aACA,gBACA;AACA,iBAAe,aAAa,OAAO,OAAO,KAAK,gDAAgD;AAE/F,MAAI,CAAC,eAAe,YAAY;AAC9B,kBAAe,aAAa,OAAO,OAAO,MAAM,4DAA4D;AAC5G;;EAGF,MAAM,EAAE,YAAY,MAAM,KAAK,cAAc,eAAe,eAAe,cAAc,EAAE,aAAa,CAAC;AAEzG,SAAO,IAAI,8BAA8B,SAAS;GAChD,cAAc,eAAe;GAC7B,YAAY,eAAe;GAC3B,kBAAkB;GACnB,CAAC"}