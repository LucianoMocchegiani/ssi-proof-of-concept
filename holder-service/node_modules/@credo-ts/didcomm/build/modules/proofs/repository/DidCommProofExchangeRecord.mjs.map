{"version":3,"file":"DidCommProofExchangeRecord.mjs","names":[],"sources":["../../../../src/modules/proofs/repository/DidCommProofExchangeRecord.ts"],"sourcesContent":["import type { TagsBase } from '@credo-ts/core'\nimport { BaseRecord, CredoError, utils } from '@credo-ts/core'\nimport type { DidCommProofRole, DidCommProofState } from '../models'\nimport type { DidCommAutoAcceptProof } from '../models/DidCommProofAutoAcceptType'\n\nexport interface DidCommProofExchangeRecordProps {\n  id?: string\n  createdAt?: Date\n  protocolVersion: string\n  isVerified?: boolean\n  state: DidCommProofState\n  role: DidCommProofRole\n  connectionId?: string\n  threadId: string\n  parentThreadId?: string\n  tags?: CustomDidCommProofExchangeTags\n  autoAcceptProof?: DidCommAutoAcceptProof\n  errorMessage?: string\n}\n\nexport type CustomDidCommProofExchangeTags = TagsBase\nexport type DefaultDidCommProofExchangeTags = {\n  threadId: string\n  parentThreadId?: string\n  connectionId?: string\n  state: DidCommProofState\n  role: DidCommProofRole\n}\n\nexport class DidCommProofExchangeRecord extends BaseRecord<\n  DefaultDidCommProofExchangeTags,\n  CustomDidCommProofExchangeTags\n> {\n  public connectionId?: string\n  public threadId!: string\n  public protocolVersion!: string\n  public parentThreadId?: string\n  public isVerified?: boolean\n  public state!: DidCommProofState\n  public role!: DidCommProofRole\n  public autoAcceptProof?: DidCommAutoAcceptProof\n  public errorMessage?: string\n\n  public static readonly type = 'ProofRecord'\n  public readonly type = DidCommProofExchangeRecord.type\n\n  public constructor(props: DidCommProofExchangeRecordProps) {\n    super()\n\n    if (props) {\n      this.id = props.id ?? utils.uuid()\n      this.createdAt = props.createdAt ?? new Date()\n      this.protocolVersion = props.protocolVersion\n\n      this.isVerified = props.isVerified\n      this.state = props.state\n      this.role = props.role\n      this.connectionId = props.connectionId\n      this.threadId = props.threadId\n      this.parentThreadId = props.parentThreadId\n      this.autoAcceptProof = props.autoAcceptProof\n      this._tags = props.tags ?? {}\n      this.errorMessage = props.errorMessage\n    }\n  }\n\n  public getTags() {\n    return {\n      ...this._tags,\n      threadId: this.threadId,\n      parentThreadId: this.parentThreadId,\n      connectionId: this.connectionId,\n      state: this.state,\n      role: this.role,\n    }\n  }\n\n  public assertState(expectedStates: DidCommProofState | DidCommProofState[]) {\n    if (!Array.isArray(expectedStates)) {\n      expectedStates = [expectedStates]\n    }\n\n    if (!expectedStates.includes(this.state)) {\n      throw new CredoError(\n        `Proof record is in invalid state ${this.state}. Valid states are: ${expectedStates.join(', ')}.`\n      )\n    }\n  }\n\n  public assertProtocolVersion(version: string) {\n    if (this.protocolVersion !== version) {\n      throw new CredoError(\n        `Proof record has invalid protocol version ${this.protocolVersion}. Expected version ${version}`\n      )\n    }\n  }\n\n  public assertConnection(currentConnectionId: string) {\n    if (!this.connectionId) {\n      throw new CredoError(\n        'Proof record is not associated with any connection. This is often the case with connection-less presentation exchange'\n      )\n    }\n    if (this.connectionId !== currentConnectionId) {\n      throw new CredoError(\n        `Proof record is associated with connection '${this.connectionId}'. Current connection is '${currentConnectionId}'`\n      )\n    }\n  }\n}\n"],"mappings":";;;AA6BA,IAAa,6BAAb,MAAa,mCAAmC,WAG9C;CAcA,AAAO,YAAY,OAAwC;AACzD,SAAO;OAHO,OAAO,2BAA2B;AAKhD,MAAI,OAAO;AACT,QAAK,KAAK,MAAM,MAAM,MAAM,MAAM;AAClC,QAAK,YAAY,MAAM,6BAAa,IAAI,MAAM;AAC9C,QAAK,kBAAkB,MAAM;AAE7B,QAAK,aAAa,MAAM;AACxB,QAAK,QAAQ,MAAM;AACnB,QAAK,OAAO,MAAM;AAClB,QAAK,eAAe,MAAM;AAC1B,QAAK,WAAW,MAAM;AACtB,QAAK,iBAAiB,MAAM;AAC5B,QAAK,kBAAkB,MAAM;AAC7B,QAAK,QAAQ,MAAM,QAAQ,EAAE;AAC7B,QAAK,eAAe,MAAM;;;CAI9B,AAAO,UAAU;AACf,SAAO;GACL,GAAG,KAAK;GACR,UAAU,KAAK;GACf,gBAAgB,KAAK;GACrB,cAAc,KAAK;GACnB,OAAO,KAAK;GACZ,MAAM,KAAK;GACZ;;CAGH,AAAO,YAAY,gBAAyD;AAC1E,MAAI,CAAC,MAAM,QAAQ,eAAe,CAChC,kBAAiB,CAAC,eAAe;AAGnC,MAAI,CAAC,eAAe,SAAS,KAAK,MAAM,CACtC,OAAM,IAAI,WACR,oCAAoC,KAAK,MAAM,sBAAsB,eAAe,KAAK,KAAK,CAAC,GAChG;;CAIL,AAAO,sBAAsB,SAAiB;AAC5C,MAAI,KAAK,oBAAoB,QAC3B,OAAM,IAAI,WACR,6CAA6C,KAAK,gBAAgB,qBAAqB,UACxF;;CAIL,AAAO,iBAAiB,qBAA6B;AACnD,MAAI,CAAC,KAAK,aACR,OAAM,IAAI,WACR,wHACD;AAEH,MAAI,KAAK,iBAAiB,oBACxB,OAAM,IAAI,WACR,+CAA+C,KAAK,aAAa,4BAA4B,oBAAoB,GAClH;;;2BA/DkB,OAAO"}