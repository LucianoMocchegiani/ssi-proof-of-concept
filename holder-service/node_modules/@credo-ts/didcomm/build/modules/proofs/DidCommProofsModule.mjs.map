{"version":3,"file":"DidCommProofsModule.mjs","names":[],"sources":["../../../src/modules/proofs/DidCommProofsModule.ts"],"sourcesContent":["import type { AgentContext, ApiModule, Constructor, DependencyManager, Optional } from '@credo-ts/core'\nimport { DidCommFeatureRegistry } from '../../DidCommFeatureRegistry'\nimport { DidCommMessageHandlerRegistry } from '../../DidCommMessageHandlerRegistry'\nimport { DidCommProofsApi } from './DidCommProofsApi'\nimport type { DidCommProofsModuleConfigOptions } from './DidCommProofsModuleConfig'\nimport { DidCommProofsModuleConfig } from './DidCommProofsModuleConfig'\nimport { DidCommProofV2Protocol } from './protocol'\nimport type { DidCommProofProtocol } from './protocol/DidCommProofProtocol'\nimport { DidCommProofExchangeRepository } from './repository'\n\n/**\n * Default proofProtocols that will be registered if the `proofProtocols` property is not configured.\n */\nexport type DefaultDidCommProofProtocols = [DidCommProofV2Protocol<[]>]\n\n// ProofsModuleOptions makes the proofProtocols property optional from the config, as it will set it when not provided.\nexport type DidCommProofsModuleOptions<ProofProtocols extends DidCommProofProtocol[]> = Optional<\n  DidCommProofsModuleConfigOptions<ProofProtocols>,\n  'proofProtocols'\n>\n\nexport class DidCommProofsModule<ProofProtocols extends DidCommProofProtocol[] = DefaultDidCommProofProtocols>\n  implements ApiModule\n{\n  public readonly config: DidCommProofsModuleConfig<ProofProtocols>\n\n  public readonly api: Constructor<DidCommProofsApi<ProofProtocols>> = DidCommProofsApi\n\n  public constructor(config?: DidCommProofsModuleOptions<ProofProtocols>) {\n    this.config = new DidCommProofsModuleConfig({\n      ...config,\n      // NOTE: the proofProtocols defaults are set in the DidCommProofsModule rather than the ProofsModuleConfig to\n      // avoid dependency cycles.\n      proofProtocols: config?.proofProtocols ?? [new DidCommProofV2Protocol({ proofFormats: [] })],\n    }) as DidCommProofsModuleConfig<ProofProtocols>\n  }\n\n  /**\n   * Registers the dependencies of the proofs module on the dependency manager.\n   */\n  public register(dependencyManager: DependencyManager) {\n    // Config\n    dependencyManager.registerInstance(DidCommProofsModuleConfig, this.config)\n\n    // Repositories\n    dependencyManager.registerSingleton(DidCommProofExchangeRepository)\n  }\n\n  public async initialize(agentContext: AgentContext): Promise<void> {\n    const messageHandlerRegistry = agentContext.dependencyManager.resolve(DidCommMessageHandlerRegistry)\n    const featureRegistry = agentContext.dependencyManager.resolve(DidCommFeatureRegistry)\n    for (const proofProtocol of this.config.proofProtocols) {\n      proofProtocol.register(messageHandlerRegistry, featureRegistry)\n\n      if (proofProtocol.constructor.name === 'DidCommCredentialV1Protocol') {\n        agentContext.config.logger.debug(\n          \"The 'DidCommCredentialV1Protocol' is deprecated and will be removed in version 0.7 of Credo. You should upgrade to the 'DidCommCredentialV2Protocol' instead.\"\n        )\n      }\n    }\n  }\n}\n"],"mappings":";;;;;;;;;;AAqBA,IAAa,sBAAb,MAEA;CAKE,AAAO,YAAY,QAAqD;OAFxD,MAAqD;AAGnE,OAAK,SAAS,IAAI,0BAA0B;GAC1C,GAAG;GAGH,gBAAgB,QAAQ,kBAAkB,CAAC,IAAI,uBAAuB,EAAE,cAAc,EAAE,EAAE,CAAC,CAAC;GAC7F,CAAC;;;;;CAMJ,AAAO,SAAS,mBAAsC;AAEpD,oBAAkB,iBAAiB,2BAA2B,KAAK,OAAO;AAG1E,oBAAkB,kBAAkB,+BAA+B;;CAGrE,MAAa,WAAW,cAA2C;EACjE,MAAM,yBAAyB,aAAa,kBAAkB,QAAQ,8BAA8B;EACpG,MAAM,kBAAkB,aAAa,kBAAkB,QAAQ,uBAAuB;AACtF,OAAK,MAAM,iBAAiB,KAAK,OAAO,gBAAgB;AACtD,iBAAc,SAAS,wBAAwB,gBAAgB;AAE/D,OAAI,cAAc,YAAY,SAAS,8BACrC,cAAa,OAAO,OAAO,MACzB,gKACD"}