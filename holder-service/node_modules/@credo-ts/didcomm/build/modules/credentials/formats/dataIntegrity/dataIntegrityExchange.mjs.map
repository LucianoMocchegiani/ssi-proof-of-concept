{"version":3,"file":"dataIntegrityExchange.mjs","names":[],"sources":["../../../../../src/modules/credentials/formats/dataIntegrity/dataIntegrityExchange.ts"],"sourcesContent":["import { type JsonObject, JsonTransformer, W3cCredential } from '@credo-ts/core'\nimport { Expose, Type } from 'class-transformer'\nimport { ArrayNotEmpty, IsBoolean, IsEnum, IsOptional, IsString, ValidateNested } from 'class-validator'\n\nconst SUPPORTED_W3C_VC_DATA_MODEL_VERSIONS = ['1.1', '2.0'] as const\nexport type W3C_VC_DATA_MODEL_VERSION = (typeof SUPPORTED_W3C_VC_DATA_MODEL_VERSIONS)[number]\n\nexport interface AnonCredsLinkSecretBindingMethodOptions {\n  credentialDefinitionId: string\n  nonce: string\n  keyCorrectnessProof: Record<string, unknown>\n}\n\n// This binding method is intended to be used in combination with a credential containing an AnonCreds proof.\nexport class AnonCredsLinkSecretBindingMethod {\n  public constructor(options: AnonCredsLinkSecretBindingMethodOptions) {\n    if (options) {\n      this.credentialDefinitionId = options.credentialDefinitionId\n      this.nonce = options.nonce\n      this.keyCorrectnessProof = options.keyCorrectnessProof\n    }\n  }\n\n  @IsString()\n  @Expose({ name: 'cred_def_id' })\n  public credentialDefinitionId!: string\n\n  @IsString()\n  public nonce!: string\n\n  @Expose({ name: 'key_correctness_proof' })\n  public keyCorrectnessProof!: Record<string, unknown>\n}\n\nexport interface DidCommSignedAttachmentBindingMethodOptions {\n  algSupported: string[]\n  didMethodsSupported: string[]\n  nonce: string\n}\n\nexport class DidCommSignedAttachmentBindingMethod {\n  public constructor(options: DidCommSignedAttachmentBindingMethodOptions) {\n    if (options) {\n      this.algsSupported = options.algSupported\n      this.didMethodsSupported = options.didMethodsSupported\n      this.nonce = options.nonce\n    }\n  }\n\n  @IsString({ each: true })\n  @Expose({ name: 'algs_supported' })\n  public algsSupported!: string[]\n\n  @IsString({ each: true })\n  @Expose({ name: 'did_methods_supported' })\n  public didMethodsSupported!: string[]\n\n  @IsString()\n  public nonce!: string\n}\n\nexport interface DataIntegrityBindingMethodsOptions {\n  anonCredsLinkSecret?: AnonCredsLinkSecretBindingMethod\n  didcommSignedAttachment?: DidCommSignedAttachmentBindingMethod\n}\n\nexport class DataIntegrityBindingMethods {\n  public constructor(options: DataIntegrityBindingMethodsOptions) {\n    if (options) {\n      this.anoncredsLinkSecret = options.anonCredsLinkSecret\n      this.didcommSignedAttachment = options.didcommSignedAttachment\n    }\n  }\n\n  @IsOptional()\n  @ValidateNested()\n  @Type(() => AnonCredsLinkSecretBindingMethod)\n  @Expose({ name: 'anoncreds_link_secret' })\n  public anoncredsLinkSecret?: AnonCredsLinkSecretBindingMethod\n\n  @IsOptional()\n  @ValidateNested()\n  @Type(() => DidCommSignedAttachmentBindingMethod)\n  @Expose({ name: 'didcomm_signed_attachment' })\n  public didcommSignedAttachment?: DidCommSignedAttachmentBindingMethod\n}\n\nexport interface DataIntegrityCredentialOfferOptions {\n  dataModelVersionsSupported: W3C_VC_DATA_MODEL_VERSION[]\n  bindingRequired?: boolean\n  bindingMethod?: DataIntegrityBindingMethods\n  credential: W3cCredential | JsonObject\n}\n\nexport class DataIntegrityCredentialOffer {\n  public constructor(options: DataIntegrityCredentialOfferOptions) {\n    if (options) {\n      this.credential =\n        options.credential instanceof W3cCredential ? JsonTransformer.toJSON(options.credential) : options.credential\n      this.bindingRequired = options.bindingRequired\n      this.bindingMethod = options.bindingMethod\n      this.dataModelVersionsSupported = options.dataModelVersionsSupported\n    }\n  }\n\n  // List of strings indicating the supported VC Data Model versions.\n  // The list MUST contain at least one value. The values MUST be a valid data model version. Current supported values include 1.1 and 2.0.\n  @ArrayNotEmpty()\n  @IsEnum(SUPPORTED_W3C_VC_DATA_MODEL_VERSIONS, { each: true })\n  @Expose({ name: 'data_model_versions_supported' })\n  public dataModelVersionsSupported!: W3C_VC_DATA_MODEL_VERSION[]\n\n  // Boolean indicating whether the credential MUST be bound to the holder. If omitted, the credential is not required to be bound to the holder.\n  // If set to true, the credential MUST be bound to the holder using at least one of the binding methods defined in binding_method.\n  @IsOptional()\n  @IsBoolean()\n  @Expose({ name: 'binding_required' })\n  public bindingRequired?: boolean\n\n  // Required if binding_required is true.\n  // Object containing key-value pairs of binding methods supported by the issuer to bind the credential to a holder.\n  // If the value is omitted, this indicates the issuer does not support any binding methods for issuance of the credential.\n  @IsOptional()\n  @ValidateNested()\n  @Type(() => DataIntegrityBindingMethods)\n  @Expose({ name: 'binding_method' })\n  public bindingMethod?: DataIntegrityBindingMethods\n\n  // The credential should be compliant with the VC Data Model.\n  // The credential MUST NOT contain any proofs.\n  // Some properties MAY be omitted if they will only be available at time of issuance, such as issuanceDate, issuer, credentialSubject.id, credentialStatus, credentialStatus.id.\n  // The credential MUST be conformant with one of the data model versions indicated in data_model_versions_supported.\n  @Expose({ name: 'credential' })\n  public credential!: JsonObject\n}\n\nexport interface AnonCredsLinkSecretDataIntegrityBindingProof {\n  cred_def_id: string\n  entropy: string\n  blinded_ms: Record<string, unknown>\n  blinded_ms_correctness_proof: Record<string, unknown>\n  nonce: string\n}\n\nexport interface DidCommSignedAttachmentDataIntegrityBindingProof {\n  // The id of the appended attachment included in the request message that contains the signed attachment.\n  attachment_id: string\n}\n\nexport interface DataIntegrityCredentialRequestBindingProof {\n  anoncreds_link_secret?: AnonCredsLinkSecretDataIntegrityBindingProof\n  didcomm_signed_attachment?: DidCommSignedAttachmentDataIntegrityBindingProof\n}\n\nexport interface DataIntegrityCredentialRequest {\n  // The data model version of the credential to be issued. The value MUST be a valid data model version and match one of the values from the data_model_versions_supported offer.\n  data_model_version: W3C_VC_DATA_MODEL_VERSION\n  // Required if binding_required is true in the offer.\n  // Object containing key-value pairs of proofs for the binding to the holder.\n  // The keys MUST match keys of the binding_method object from the offer.\n  // See Binding Methods for a registry of default binding methods supported as part of this RFC.\n  binding_proof?: DataIntegrityCredentialRequestBindingProof\n}\n\nexport interface AnonCredsLinkSecretCredentialRequestOptions {\n  linkSecretId?: string\n}\n\nexport interface DidCommSignedAttachmentCredentialRequestOptions {\n  kid: string\n  alg?: string\n}\n\nexport interface DataIntegrityCredential {\n  credential: JsonObject\n}\n"],"mappings":";;;;;;;;AAIA,MAAM,uCAAuC,CAAC,OAAO,MAAM;AAU3D,IAAa,mCAAb,MAA8C;CAC5C,AAAO,YAAY,SAAkD;AACnE,MAAI,SAAS;AACX,QAAK,yBAAyB,QAAQ;AACtC,QAAK,QAAQ,QAAQ;AACrB,QAAK,sBAAsB,QAAQ;;;;;CAItC,UAAU;CACV,OAAO,EAAE,MAAM,eAAe,CAAC;;;YAG/B,UAAU;YAGV,OAAO,EAAE,MAAM,yBAAyB,CAAC;AAU5C,IAAa,uCAAb,MAAkD;CAChD,AAAO,YAAY,SAAsD;AACvE,MAAI,SAAS;AACX,QAAK,gBAAgB,QAAQ;AAC7B,QAAK,sBAAsB,QAAQ;AACnC,QAAK,QAAQ,QAAQ;;;;;CAIxB,SAAS,EAAE,MAAM,MAAM,CAAC;CACxB,OAAO,EAAE,MAAM,kBAAkB,CAAC;;;;CAGlC,SAAS,EAAE,MAAM,MAAM,CAAC;CACxB,OAAO,EAAE,MAAM,yBAAyB,CAAC;;;YAGzC,UAAU;AASb,IAAa,8BAAb,MAAyC;CACvC,AAAO,YAAY,SAA6C;AAC9D,MAAI,SAAS;AACX,QAAK,sBAAsB,QAAQ;AACnC,QAAK,0BAA0B,QAAQ;;;;;CAI1C,YAAY;CACZ,gBAAgB;CAChB,WAAW,iCAAiC;CAC5C,OAAO,EAAE,MAAM,yBAAyB,CAAC;;;;CAGzC,YAAY;CACZ,gBAAgB;CAChB,WAAW,qCAAqC;CAChD,OAAO,EAAE,MAAM,6BAA6B,CAAC;;;AAWhD,IAAa,+BAAb,MAA0C;CACxC,AAAO,YAAY,SAA8C;AAC/D,MAAI,SAAS;AACX,QAAK,aACH,QAAQ,sBAAsB,gBAAgB,gBAAgB,OAAO,QAAQ,WAAW,GAAG,QAAQ;AACrG,QAAK,kBAAkB,QAAQ;AAC/B,QAAK,gBAAgB,QAAQ;AAC7B,QAAK,6BAA6B,QAAQ;;;;;CAM7C,eAAe;CACf,OAAO,sCAAsC,EAAE,MAAM,MAAM,CAAC;CAC5D,OAAO,EAAE,MAAM,iCAAiC,CAAC;;;;CAKjD,YAAY;CACZ,WAAW;CACX,OAAO,EAAE,MAAM,oBAAoB,CAAC;;;;CAMpC,YAAY;CACZ,gBAAgB;CAChB,WAAW,4BAA4B;CACvC,OAAO,EAAE,MAAM,kBAAkB,CAAC;;;YAOlC,OAAO,EAAE,MAAM,cAAc,CAAC"}