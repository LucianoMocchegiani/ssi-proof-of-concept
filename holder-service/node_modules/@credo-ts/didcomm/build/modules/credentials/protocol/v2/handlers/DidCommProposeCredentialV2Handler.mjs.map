{"version":3,"file":"DidCommProposeCredentialV2Handler.mjs","names":[],"sources":["../../../../../../src/modules/credentials/protocol/v2/handlers/DidCommProposeCredentialV2Handler.ts"],"sourcesContent":["import type { DidCommMessageHandler, DidCommMessageHandlerInboundMessage } from '../../../../../handlers'\nimport type { DidCommInboundMessageContext } from '../../../../../models'\nimport { DidCommOutboundMessageContext } from '../../../../../models'\nimport type { DidCommCredentialExchangeRecord } from '../../../repository/DidCommCredentialExchangeRecord'\nimport type { DidCommCredentialV2Protocol } from '../DidCommCredentialV2Protocol'\nimport { DidCommProposeCredentialV2Message } from '../messages/DidCommProposeCredentialV2Message'\n\nexport class DidCommProposeCredentialV2Handler implements DidCommMessageHandler {\n  private credentialProtocol: DidCommCredentialV2Protocol\n\n  public supportedMessages = [DidCommProposeCredentialV2Message]\n\n  public constructor(credentialProtocol: DidCommCredentialV2Protocol) {\n    this.credentialProtocol = credentialProtocol\n  }\n\n  public async handle(messageContext: DidCommInboundMessageContext<DidCommProposeCredentialV2Message>) {\n    const credentialExchangeRecord = await this.credentialProtocol.processProposal(messageContext)\n\n    const shouldAutoRespond = await this.credentialProtocol.shouldAutoRespondToProposal(messageContext.agentContext, {\n      credentialExchangeRecord,\n      proposalMessage: messageContext.message,\n    })\n\n    if (shouldAutoRespond) {\n      return await this.acceptProposal(credentialExchangeRecord, messageContext)\n    }\n  }\n\n  private async acceptProposal(\n    credentialExchangeRecord: DidCommCredentialExchangeRecord,\n    messageContext: DidCommMessageHandlerInboundMessage<DidCommProposeCredentialV2Handler>\n  ) {\n    messageContext.agentContext.config.logger.info('Automatically sending offer with autoAccept')\n\n    if (!messageContext.connection) {\n      messageContext.agentContext.config.logger.error('No connection on the messageContext, aborting auto accept')\n      return\n    }\n\n    const { message } = await this.credentialProtocol.acceptProposal(messageContext.agentContext, {\n      credentialExchangeRecord,\n    })\n\n    return new DidCommOutboundMessageContext(message, {\n      agentContext: messageContext.agentContext,\n      connection: messageContext.connection,\n      associatedRecord: credentialExchangeRecord,\n    })\n  }\n}\n"],"mappings":";;;;;AAOA,IAAa,oCAAb,MAAgF;CAK9E,AAAO,YAAY,oBAAiD;OAF7D,oBAAoB,CAAC,kCAAkC;AAG5D,OAAK,qBAAqB;;CAG5B,MAAa,OAAO,gBAAiF;EACnG,MAAM,2BAA2B,MAAM,KAAK,mBAAmB,gBAAgB,eAAe;AAO9F,MAL0B,MAAM,KAAK,mBAAmB,4BAA4B,eAAe,cAAc;GAC/G;GACA,iBAAiB,eAAe;GACjC,CAAC,CAGA,QAAO,MAAM,KAAK,eAAe,0BAA0B,eAAe;;CAI9E,MAAc,eACZ,0BACA,gBACA;AACA,iBAAe,aAAa,OAAO,OAAO,KAAK,8CAA8C;AAE7F,MAAI,CAAC,eAAe,YAAY;AAC9B,kBAAe,aAAa,OAAO,OAAO,MAAM,4DAA4D;AAC5G;;EAGF,MAAM,EAAE,YAAY,MAAM,KAAK,mBAAmB,eAAe,eAAe,cAAc,EAC5F,0BACD,CAAC;AAEF,SAAO,IAAI,8BAA8B,SAAS;GAChD,cAAc,eAAe;GAC7B,YAAY,eAAe;GAC3B,kBAAkB;GACnB,CAAC"}