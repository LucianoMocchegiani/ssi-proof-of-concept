{"version":3,"file":"DidCommOfferCredentialV2Handler.mjs","names":[],"sources":["../../../../../../src/modules/credentials/protocol/v2/handlers/DidCommOfferCredentialV2Handler.ts"],"sourcesContent":["import { getOutboundDidCommMessageContext } from '../../../../../getDidCommOutboundMessageContext'\nimport type { DidCommMessageHandler, DidCommMessageHandlerInboundMessage } from '../../../../../handlers'\nimport type { DidCommInboundMessageContext } from '../../../../../models'\nimport type { DidCommCredentialExchangeRecord } from '../../../repository/DidCommCredentialExchangeRecord'\nimport type { DidCommCredentialV2Protocol } from '../DidCommCredentialV2Protocol'\nimport { DidCommOfferCredentialV2Message } from '../messages/DidCommOfferCredentialV2Message'\n\nexport class DidCommOfferCredentialV2Handler implements DidCommMessageHandler {\n  private credentialProtocol: DidCommCredentialV2Protocol\n\n  public supportedMessages = [DidCommOfferCredentialV2Message]\n\n  public constructor(credentialProtocol: DidCommCredentialV2Protocol) {\n    this.credentialProtocol = credentialProtocol\n  }\n\n  public async handle(messageContext: DidCommInboundMessageContext<DidCommOfferCredentialV2Message>) {\n    const credentialExchangeRecord = await this.credentialProtocol.processOffer(messageContext)\n\n    const shouldAutoRespond = await this.credentialProtocol.shouldAutoRespondToOffer(messageContext.agentContext, {\n      credentialExchangeRecord,\n      offerMessage: messageContext.message,\n    })\n    if (shouldAutoRespond) {\n      return await this.acceptOffer(credentialExchangeRecord, messageContext)\n    }\n  }\n\n  private async acceptOffer(\n    credentialExchangeRecord: DidCommCredentialExchangeRecord,\n    messageContext: DidCommMessageHandlerInboundMessage<DidCommOfferCredentialV2Handler>\n  ) {\n    messageContext.agentContext.config.logger.info('Automatically sending request with autoAccept')\n\n    const { message } = await this.credentialProtocol.acceptOffer(messageContext.agentContext, {\n      credentialExchangeRecord,\n    })\n\n    return getOutboundDidCommMessageContext(messageContext.agentContext, {\n      connectionRecord: messageContext.connection,\n      message,\n      associatedRecord: credentialExchangeRecord,\n      lastReceivedMessage: messageContext.message,\n    })\n  }\n}\n"],"mappings":";;;;AAOA,IAAa,kCAAb,MAA8E;CAK5E,AAAO,YAAY,oBAAiD;OAF7D,oBAAoB,CAAC,gCAAgC;AAG1D,OAAK,qBAAqB;;CAG5B,MAAa,OAAO,gBAA+E;EACjG,MAAM,2BAA2B,MAAM,KAAK,mBAAmB,aAAa,eAAe;AAM3F,MAJ0B,MAAM,KAAK,mBAAmB,yBAAyB,eAAe,cAAc;GAC5G;GACA,cAAc,eAAe;GAC9B,CAAC,CAEA,QAAO,MAAM,KAAK,YAAY,0BAA0B,eAAe;;CAI3E,MAAc,YACZ,0BACA,gBACA;AACA,iBAAe,aAAa,OAAO,OAAO,KAAK,gDAAgD;EAE/F,MAAM,EAAE,YAAY,MAAM,KAAK,mBAAmB,YAAY,eAAe,cAAc,EACzF,0BACD,CAAC;AAEF,SAAO,iCAAiC,eAAe,cAAc;GACnE,kBAAkB,eAAe;GACjC;GACA,kBAAkB;GAClB,qBAAqB,eAAe;GACrC,CAAC"}