{"version":3,"file":"DidCommCredentialProtocolOptions.mjs","names":[],"sources":["../../../../src/modules/credentials/protocol/DidCommCredentialProtocolOptions.ts"],"sourcesContent":["import type { DidCommMessage } from '../../../DidCommMessage'\nimport type { DidCommConnectionRecord } from '../../connections'\nimport type {\n  DidCommCredentialFormat,\n  DidCommCredentialFormatPayload,\n  DidCommCredentialFormatService,\n  ExtractCredentialFormats,\n} from '../formats'\nimport type { DidCommCredentialPreviewAttributeOptions } from '../models'\nimport type { DidCommAutoAcceptCredential } from '../models/DidCommCredentialAutoAcceptType'\nimport type { DidCommCredentialExchangeRecord } from '../repository/DidCommCredentialExchangeRecord'\nimport type { DidCommCredentialProtocol } from './DidCommCredentialProtocol'\n\n/**\n * Get the format data payload for a specific message from a list of CredentialFormat interfaces and a message\n *\n * For an indy offer, this resolves to the cred abstract format as defined here:\n * https://github.com/hyperledger/aries-rfcs/tree/b3a3942ef052039e73cd23d847f42947f8287da2/features/0592-indy-attachments#cred-abstract-format\n *\n * @example\n * ```\n *\n * type OfferFormatData = CredentialFormatDataMessagePayload<[IndyCredentialFormat, JsonLdCredentialFormat], 'createOffer'>\n *\n * // equal to\n * type OfferFormatData = {\n *  indy: {\n *   // ... payload for indy offer attachment as defined in RFC 0592 ...\n *  },\n *  jsonld: {\n *   // ... payload for jsonld offer attachment as defined in RFC 0593 ...\n *  }\n * }\n * ```\n */\nexport type CredentialFormatDataMessagePayload<\n  CFs extends DidCommCredentialFormat[] = DidCommCredentialFormat[],\n  M extends keyof DidCommCredentialFormat['formatData'] = keyof DidCommCredentialFormat['formatData'],\n> = {\n  [Service in CFs[number] as Service['formatKey']]?: Service['formatData'][M]\n}\n\n/**\n * Infer the {@link DidCommCredentialFormat} types based on an array of {@link DidCommCredentialProtocol} types.\n *\n * It does this by extracting the `CredentialFormatServices` generic from the `DidCommCredentialProtocol`, and\n * then extracting the `CredentialFormat` generic from each of the `CredentialFormatService` types.\n *\n * @example\n * ```\n * // TheCredentialFormatServices is now equal to [IndyCredentialFormatService]\n * type TheCredentialFormatServices = CredentialFormatsFromProtocols<[DidCommCredentialV1Protocol]>\n * ```\n *\n * Because the `DidCommCredentialV1Protocol` is defined as follows:\n * ```\n * class DidCommCredentialV1Protocol implements DidCommCredentialProtocol<[IndyCredentialFormatService]> {\n * }\n * ```\n */\nexport type CredentialFormatsFromProtocols<Type extends DidCommCredentialProtocol[]> =\n  Type[number] extends DidCommCredentialProtocol<infer CredentialFormatServices>\n    ? CredentialFormatServices extends DidCommCredentialFormatService[]\n      ? ExtractCredentialFormats<CredentialFormatServices>\n      : never\n    : never\n\n/**\n * Get format data return value. Each key holds a mapping of credential format key to format data.\n *\n * @example\n * ```\n * {\n *   proposal: {\n *     indy: {\n *       cred_def_id: string\n *     }\n *   }\n * }\n * ```\n */\nexport type GetCredentialFormatDataReturn<CFs extends DidCommCredentialFormat[] = DidCommCredentialFormat[]> = {\n  proposalAttributes?: DidCommCredentialPreviewAttributeOptions[]\n  proposal?: CredentialFormatDataMessagePayload<CFs, 'proposal'>\n  offer?: CredentialFormatDataMessagePayload<CFs, 'offer'>\n  offerAttributes?: DidCommCredentialPreviewAttributeOptions[]\n  request?: CredentialFormatDataMessagePayload<CFs, 'request'>\n  credential?: CredentialFormatDataMessagePayload<CFs, 'credential'>\n}\n\ninterface BaseOptions {\n  comment?: string\n  autoAcceptCredential?: DidCommAutoAcceptCredential\n\n  /**\n   * Will be ignored for v1 protocol as it is not supported\n   */\n  goalCode?: string\n\n  /**\n   * Will be ignored for v1 protocol as it is not supported\n   */\n  goal?: string\n}\n\nexport interface CreateCredentialProposalOptions<CFs extends DidCommCredentialFormatService[]> extends BaseOptions {\n  connectionRecord: DidCommConnectionRecord\n  credentialFormats: DidCommCredentialFormatPayload<ExtractCredentialFormats<CFs>, 'createProposal'>\n}\n\nexport interface AcceptCredentialProposalOptions<CFs extends DidCommCredentialFormatService[]> extends BaseOptions {\n  credentialExchangeRecord: DidCommCredentialExchangeRecord\n  credentialFormats?: DidCommCredentialFormatPayload<ExtractCredentialFormats<CFs>, 'acceptProposal'>\n}\n\nexport interface NegotiateCredentialProposalOptions<CFs extends DidCommCredentialFormatService[]> {\n  credentialExchangeRecord: DidCommCredentialExchangeRecord\n  credentialFormats: DidCommCredentialFormatPayload<ExtractCredentialFormats<CFs>, 'createOffer'>\n  autoAcceptCredential?: DidCommAutoAcceptCredential\n  comment?: string\n\n  /**\n   * Will be ignored for v1 protocol as it is not supported\n   */\n  goalCode?: string\n\n  /**\n   * Will be ignored for v1 protocol as it is not supported\n   */\n  goal?: string\n}\n\nexport interface CreateCredentialOfferOptions<CFs extends DidCommCredentialFormatService[]> extends BaseOptions {\n  // Create offer can also be used for connection-less, so connection is optional\n  connectionRecord?: DidCommConnectionRecord\n  credentialFormats: DidCommCredentialFormatPayload<ExtractCredentialFormats<CFs>, 'createOffer'>\n}\n\nexport interface AcceptCredentialOfferOptions<CFs extends DidCommCredentialFormatService[]> extends BaseOptions {\n  credentialExchangeRecord: DidCommCredentialExchangeRecord\n  credentialFormats?: DidCommCredentialFormatPayload<ExtractCredentialFormats<CFs>, 'acceptOffer'>\n}\n\nexport interface NegotiateCredentialOfferOptions<CFs extends DidCommCredentialFormatService[]> extends BaseOptions {\n  credentialExchangeRecord: DidCommCredentialExchangeRecord\n  credentialFormats: DidCommCredentialFormatPayload<ExtractCredentialFormats<CFs>, 'createProposal'>\n}\n\nexport interface CreateCredentialRequestOptions<CFs extends DidCommCredentialFormatService[]> extends BaseOptions {\n  connectionRecord: DidCommConnectionRecord\n  credentialFormats: DidCommCredentialFormatPayload<ExtractCredentialFormats<CFs>, 'createRequest'>\n}\n\nexport interface AcceptCredentialRequestOptions<CFs extends DidCommCredentialFormatService[]> extends BaseOptions {\n  credentialExchangeRecord: DidCommCredentialExchangeRecord\n  credentialFormats?: DidCommCredentialFormatPayload<ExtractCredentialFormats<CFs>, 'acceptRequest'>\n}\n\nexport interface AcceptCredentialOptions {\n  credentialExchangeRecord: DidCommCredentialExchangeRecord\n}\n\nexport interface CreateCredentialProblemReportOptions {\n  credentialExchangeRecord: DidCommCredentialExchangeRecord\n  description: string\n}\n\nexport interface CredentialProtocolMsgReturnType<MessageType extends DidCommMessage> {\n  message: MessageType\n  credentialExchangeRecord: DidCommCredentialExchangeRecord\n}\n\nexport interface DeleteCredentialOptions {\n  deleteAssociatedCredentials?: boolean\n  deleteAssociatedDidCommMessages?: boolean\n}\n"],"mappings":""}