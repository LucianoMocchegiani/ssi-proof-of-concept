{"version":3,"file":"DidCommCredentialV2Preview.mjs","names":[],"sources":["../../../../../../src/modules/credentials/protocol/v2/messages/DidCommCredentialV2Preview.ts"],"sourcesContent":["import { JsonTransformer } from '@credo-ts/core'\nimport { Expose, Transform, Type } from 'class-transformer'\nimport { IsInstance, ValidateNested } from 'class-validator'\nimport { IsValidMessageType, parseMessageType, replaceLegacyDidSovPrefix } from '../../../../../util/messageType'\nimport type { CredentialPreviewOptions } from '../../../models/DidCommCredentialPreviewAttribute'\nimport { DidCommCredentialPreviewAttribute } from '../../../models/DidCommCredentialPreviewAttribute'\n\n/**\n * Credential preview inner message class.\n *\n * This is not a message but an inner object for other messages in this protocol. It is used construct a preview of the data for the credential.\n *\n * @see https://github.com/hyperledger/aries-rfcs/tree/main/features/0453-issue-credential-v2#preview-credential\n */\nexport class DidCommCredentialV2Preview {\n  public constructor(options: CredentialPreviewOptions) {\n    if (options) {\n      this.attributes = options.attributes.map((a) => new DidCommCredentialPreviewAttribute(a))\n    }\n  }\n\n  public static readonly type = parseMessageType('https://didcomm.org/issue-credential/2.0/credential-preview')\n\n  @Expose({ name: '@type' })\n  @IsValidMessageType(DidCommCredentialV2Preview.type)\n  @Transform(({ value }) => replaceLegacyDidSovPrefix(value), {\n    toClassOnly: true,\n  })\n  public readonly type = DidCommCredentialV2Preview.type.messageTypeUri\n\n  @Type(() => DidCommCredentialPreviewAttribute)\n  @ValidateNested({ each: true })\n  @IsInstance(DidCommCredentialPreviewAttribute, { each: true })\n  public attributes!: DidCommCredentialPreviewAttribute[]\n\n  public toJSON(): Record<string, unknown> {\n    return JsonTransformer.toJSON(this)\n  }\n\n  /**\n   * Create a credential preview from a record with name and value entries.\n   *\n   * @example\n   * const preview = CredentialPreview.fromRecord({\n   *   name: \"Bob\",\n   *   age: \"20\"\n   * })\n   */\n  public static fromRecord(record: Record<string, string>) {\n    const attributes = Object.entries(record).map(\n      ([name, value]) =>\n        new DidCommCredentialPreviewAttribute({\n          name,\n          mimeType: 'text/plain',\n          value,\n        })\n    )\n\n    return new DidCommCredentialV2Preview({\n      attributes,\n    })\n  }\n}\n"],"mappings":";;;;;;;;;;;;;;;;AAcA,IAAa,6BAAb,MAAa,2BAA2B;CACtC,AAAO,YAAY,SAAmC;OAatC,OAAO,2BAA2B,KAAK;AAZrD,MAAI,QACF,MAAK,aAAa,QAAQ,WAAW,KAAK,MAAM,IAAI,kCAAkC,EAAE,CAAC;;CAkB7F,AAAO,SAAkC;AACvC,SAAO,gBAAgB,OAAO,KAAK;;;;;;;;;;;CAYrC,OAAc,WAAW,QAAgC;AAUvD,SAAO,IAAI,2BAA2B,EACpC,YAViB,OAAO,QAAQ,OAAO,CAAC,KACvC,CAAC,MAAM,WACN,IAAI,kCAAkC;GACpC;GACA,UAAU;GACV;GACD,CAAC,CACL,EAIA,CAAC;;;2BAvCmB,OAAO,iBAAiB,8DAA8D;;CAE5G,OAAO,EAAE,MAAM,SAAS,CAAC;CACzB,mBAAmB,2BAA2B,KAAK;CACnD,WAAW,EAAE,YAAY,0BAA0B,MAAM,EAAE,EAC1D,aAAa,MACd,CAAC;;;;CAGD,WAAW,kCAAkC;CAC7C,eAAe,EAAE,MAAM,MAAM,CAAC;CAC9B,WAAW,mCAAmC,EAAE,MAAM,MAAM,CAAC"}