{"version":3,"file":"DidCommMediatorApi.mjs","names":[],"sources":["../../../src/modules/routing/DidCommMediatorApi.ts"],"sourcesContent":["import { AgentContext, injectable } from '@credo-ts/core'\nimport { DidCommMessageSender } from '../../DidCommMessageSender'\nimport { DidCommOutboundMessageContext } from '../../models'\nimport { DidCommConnectionService } from '../connections'\nimport { DidCommMediatorModuleConfig } from './DidCommMediatorModuleConfig'\nimport type { DidCommMediationRecord } from './repository'\nimport { DidCommMediatorService } from './services/DidCommMediatorService'\n\n@injectable()\nexport class DidCommMediatorApi {\n  public config: DidCommMediatorModuleConfig\n\n  private mediatorService: DidCommMediatorService\n  private messageSender: DidCommMessageSender\n  private agentContext: AgentContext\n  private connectionService: DidCommConnectionService\n\n  public constructor(\n    mediationService: DidCommMediatorService,\n    messageSender: DidCommMessageSender,\n    agentContext: AgentContext,\n    connectionService: DidCommConnectionService,\n    config: DidCommMediatorModuleConfig\n  ) {\n    this.mediatorService = mediationService\n    this.messageSender = messageSender\n    this.connectionService = connectionService\n    this.agentContext = agentContext\n    this.config = config\n  }\n\n  public async grantRequestedMediation(mediationRecordId: string): Promise<DidCommMediationRecord> {\n    const record = await this.mediatorService.getById(this.agentContext, mediationRecordId)\n    const connectionRecord = await this.connectionService.getById(this.agentContext, record.connectionId)\n\n    const { message, mediationRecord } = await this.mediatorService.createGrantMediationMessage(\n      this.agentContext,\n      record\n    )\n    const outboundMessageContext = new DidCommOutboundMessageContext(message, {\n      agentContext: this.agentContext,\n      connection: connectionRecord,\n      associatedRecord: mediationRecord,\n    })\n\n    await this.messageSender.sendMessage(outboundMessageContext)\n\n    return mediationRecord\n  }\n}\n"],"mappings":";;;;;;;;;;;;;AASO,+BAAM,mBAAmB;CAQ9B,AAAO,YACL,kBACA,eACA,cACA,mBACA,QACA;AACA,OAAK,kBAAkB;AACvB,OAAK,gBAAgB;AACrB,OAAK,oBAAoB;AACzB,OAAK,eAAe;AACpB,OAAK,SAAS;;CAGhB,MAAa,wBAAwB,mBAA4D;EAC/F,MAAM,SAAS,MAAM,KAAK,gBAAgB,QAAQ,KAAK,cAAc,kBAAkB;EACvF,MAAM,mBAAmB,MAAM,KAAK,kBAAkB,QAAQ,KAAK,cAAc,OAAO,aAAa;EAErG,MAAM,EAAE,SAAS,oBAAoB,MAAM,KAAK,gBAAgB,4BAC9D,KAAK,cACL,OACD;EACD,MAAM,yBAAyB,IAAI,8BAA8B,SAAS;GACxE,cAAc,KAAK;GACnB,YAAY;GACZ,kBAAkB;GACnB,CAAC;AAEF,QAAM,KAAK,cAAc,YAAY,uBAAuB;AAE5D,SAAO;;;iCAvCV,YAAY"}