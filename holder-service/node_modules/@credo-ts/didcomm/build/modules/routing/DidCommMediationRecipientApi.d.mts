import { DidCommConnectionService } from "../connections/services/DidCommConnectionService.mjs";
import "../connections/services/index.mjs";
import { DidCommDiscoverFeaturesApi } from "../discover-features/DidCommDiscoverFeaturesApi.mjs";
import "../discover-features/index.mjs";
import { DidCommMessagePickupApi } from "../message-pickup/DidCommMessagePickupApi.mjs";
import { DidCommKeylistUpdateAction } from "./messages/DidCommKeylistUpdateMessage.mjs";
import "./messages/index.mjs";
import { DidCommMediatorPickupStrategy } from "./DidCommMediatorPickupStrategy.mjs";
import { DidCommMediationRecord } from "./repository/DidCommMediationRecord.mjs";
import { DidCommMediationRepository } from "./repository/DidCommMediationRepository.mjs";
import { DidCommMediationRecipientService } from "./services/DidCommMediationRecipientService.mjs";
import { DidCommRoutingService, GetRoutingOptions } from "./services/DidCommRoutingService.mjs";
import { DidCommMediationRecipientModuleConfig } from "./DidCommMediationRecipientModuleConfig.mjs";
import "./repository/index.mjs";
import { DidCommMessageSender } from "../../DidCommMessageSender.mjs";
import { DidCommConnectionRecord } from "../connections/repository/DidCommConnectionRecord.mjs";
import "../connections/repository/index.mjs";
import { DidCommRouting } from "../../models/DidCommRouting.mjs";
import "../../index.mjs";
import { AgentContext, DidsApi, EventEmitter, Logger } from "@credo-ts/core";
import * as rxjs0 from "rxjs";
import { Subject } from "rxjs";

//#region src/modules/routing/DidCommMediationRecipientApi.d.ts
declare class DidCommMediationRecipientApi {
  config: DidCommMediationRecipientModuleConfig;
  private mediationRecipientService;
  private connectionService;
  private dids;
  private messageSender;
  private eventEmitter;
  private logger;
  private discoverFeaturesApi;
  private messagePickupApi;
  private mediationRepository;
  private routingService;
  private agentContext;
  private stop$;
  private readonly stopMessagePickup$;
  constructor(mediationRecipientService: DidCommMediationRecipientService, connectionService: DidCommConnectionService, dids: DidsApi, messageSender: DidCommMessageSender, eventEmitter: EventEmitter, discoverFeaturesApi: DidCommDiscoverFeaturesApi, messagePickupApi: DidCommMessagePickupApi, mediationRepository: DidCommMediationRepository, routingService: DidCommRoutingService, logger: Logger, agentContext: AgentContext, stop$: Subject<boolean>, mediationRecipientModuleConfig: DidCommMediationRecipientModuleConfig);
  private sendMessage;
  /**
   * Implicit mode consists simply on initiating a long-lived session to a mediator and wait for the
   * messages to arrive automatically.
   *
   * In order to do initiate this session, we open a suitable connection (using WebSocket transport) and
   * send a Trust Ping message.
   *
   * @param mediator
   */
  private initiateImplicitMode;
  /**
   * Keep track of a persistent transport session with a mediator, trying to reconnect to it as
   * soon as it is disconnected, using a recursive back-off strategy
   *
   * @param mediator mediation record
   * @param pickupStrategy chosen pick up strategy (should be Implicit or PickUp in Live Mode)
   */
  private monitorMediatorWebSocketEvents;
  /**
   * Start a Message Pickup flow with a registered Mediator.
   *
   * @param mediator optional {MediationRecord} corresponding to the mediator to pick messages from. It will use
   * default mediator otherwise
   * @param pickupStrategy optional {DidCommMediatorPickupStrategy} to use in the loop. It will use Agent's default
   * strategy or attempt to find it by Discover Features otherwise
   * @returns
   */
  initiateMessagePickup(mediator?: DidCommMediationRecord, pickupStrategy?: DidCommMediatorPickupStrategy): Promise<rxjs0.Subscription | undefined>;
  /**
   * Terminate all ongoing Message Pickup loops
   */
  stopMessagePickup(): Promise<void>;
  private getPickupStrategyForMediator;
  discoverMediation(): Promise<DidCommMediationRecord | undefined>;
  setDefaultMediator(mediatorRecord: DidCommMediationRecord): Promise<void>;
  requestMediation(connection: DidCommConnectionRecord): Promise<DidCommMediationRecord>;
  notifyKeylistUpdate(connection: DidCommConnectionRecord, verkey: string, action?: DidCommKeylistUpdateAction): Promise<void>;
  findByConnectionId(connectionId: string): Promise<DidCommMediationRecord | null>;
  getMediators(): Promise<DidCommMediationRecord[]>;
  findDefaultMediator(): Promise<DidCommMediationRecord | null>;
  findDefaultMediatorConnection(): Promise<DidCommConnectionRecord | null>;
  requestAndAwaitGrant(connection: DidCommConnectionRecord, timeoutMs?: number): Promise<DidCommMediationRecord>;
  /**
   * Requests mediation for a given connection and sets that as default mediator.
   *
   * @param connection connection record which will be used for mediation
   * @returns mediation record
   */
  provision(connection: DidCommConnectionRecord): Promise<DidCommMediationRecord>;
  getRouting(options: GetRoutingOptions): Promise<DidCommRouting>;
}
//#endregion
export { DidCommMediationRecipientApi };
//# sourceMappingURL=DidCommMediationRecipientApi.d.mts.map