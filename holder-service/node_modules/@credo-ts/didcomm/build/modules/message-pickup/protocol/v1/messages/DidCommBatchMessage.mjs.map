{"version":3,"file":"DidCommBatchMessage.mjs","names":[],"sources":["../../../../../../src/modules/message-pickup/protocol/v1/messages/DidCommBatchMessage.ts"],"sourcesContent":["import { utils } from '@credo-ts/core'\nimport { Expose, Type } from 'class-transformer'\nimport { IsArray, IsInstance, IsObject, Matches, ValidateNested } from 'class-validator'\n\nimport { MessageIdRegExp } from '../../../../../BaseDidCommMessage'\nimport { DidCommMessage } from '../../../../../DidCommMessage'\nimport type { DidCommEncryptedMessage } from '../../../../../types'\nimport { IsValidMessageType, parseMessageType } from '../../../../../util/messageType'\n\nexport class DidCommBatchMessageMessage {\n  public constructor(options: { id?: string; message: DidCommEncryptedMessage }) {\n    if (options) {\n      this.id = options.id || utils.uuid()\n      this.message = options.message\n    }\n  }\n\n  @Matches(MessageIdRegExp)\n  public id!: string\n\n  @IsObject()\n  public message!: DidCommEncryptedMessage\n}\n\nexport interface DidCommBatchMessageOptions {\n  id?: string\n  messages: DidCommBatchMessageMessage[]\n  threadId?: string\n}\n\n/**\n * A message that contains multiple waiting messages.\n *\n * @see https://github.com/hyperledger/aries-rfcs/blob/master/features/0212-pickup/README.md#batch\n */\nexport class DidCommBatchMessage extends DidCommMessage {\n  public readonly allowQueueTransport = false\n\n  public constructor(options: DidCommBatchMessageOptions) {\n    super()\n\n    if (options) {\n      this.id = options.id || this.generateId()\n      this.messages = options.messages\n\n      if (options.threadId) {\n        this.setThread({\n          threadId: options.threadId,\n        })\n      }\n    }\n  }\n\n  @IsValidMessageType(DidCommBatchMessage.type)\n  public readonly type = DidCommBatchMessage.type.messageTypeUri\n  public static readonly type = parseMessageType('https://didcomm.org/messagepickup/1.0/batch')\n\n  @Type(() => DidCommBatchMessageMessage)\n  @IsArray()\n  @ValidateNested()\n  @IsInstance(DidCommBatchMessageMessage, { each: true })\n  @Expose({ name: 'messages~attach' })\n  public messages!: DidCommBatchMessageMessage[]\n}\n"],"mappings":";;;;;;;;;;AASA,IAAa,6BAAb,MAAwC;CACtC,AAAO,YAAY,SAA4D;AAC7E,MAAI,SAAS;AACX,QAAK,KAAK,QAAQ,MAAM,MAAM,MAAM;AACpC,QAAK,UAAU,QAAQ;;;;YAI1B,QAAQ,gBAAgB;YAGxB,UAAU;;;;;;AAeb,IAAa,sBAAb,MAAa,4BAA4B,eAAe;CAGtD,AAAO,YAAY,SAAqC;AACtD,SAAO;OAHO,sBAAsB;OAkBtB,OAAO,oBAAoB,KAAK;AAb9C,MAAI,SAAS;AACX,QAAK,KAAK,QAAQ,MAAM,KAAK,YAAY;AACzC,QAAK,WAAW,QAAQ;AAExB,OAAI,QAAQ,SACV,MAAK,UAAU,EACb,UAAU,QAAQ,UACnB,CAAC;;;;oBAOe,OAAO,iBAAiB,8CAA8C;YAF5F,mBAAmB,oBAAoB,KAAK;;CAI5C,WAAW,2BAA2B;CACtC,SAAS;CACT,gBAAgB;CAChB,WAAW,4BAA4B,EAAE,MAAM,MAAM,CAAC;CACtD,OAAO,EAAE,MAAM,mBAAmB,CAAC"}