{"version":3,"file":"DidCommConnectionRepository.mjs","names":[],"sources":["../../../../src/modules/connections/repository/DidCommConnectionRepository.ts"],"sourcesContent":["import type { AgentContext } from '@credo-ts/core'\n\nimport { EventEmitter, InjectionSymbols, inject, injectable, Repository, type StorageService } from '@credo-ts/core'\n\nimport { DidCommDidExchangeRole } from '../models'\nimport { DidCommConnectionRecord } from './DidCommConnectionRecord'\n\n@injectable()\nexport class DidCommConnectionRepository extends Repository<DidCommConnectionRecord> {\n  public constructor(\n    @inject(InjectionSymbols.StorageService) storageService: StorageService<DidCommConnectionRecord>,\n    eventEmitter: EventEmitter\n  ) {\n    super(DidCommConnectionRecord, storageService, eventEmitter)\n  }\n\n  public async findByDids(agentContext: AgentContext, { ourDid, theirDid }: { ourDid: string; theirDid: string }) {\n    return this.findSingleByQuery(\n      agentContext,\n      {\n        $or: [\n          {\n            did: ourDid,\n            theirDid,\n          },\n          { did: ourDid, previousTheirDids: [theirDid] },\n          { previousDids: [ourDid], theirDid },\n        ],\n      },\n      {\n        cacheKey: `ourDid${ourDid}theirDid${theirDid}`,\n      }\n    )\n  }\n\n  public getByThreadId(agentContext: AgentContext, threadId: string): Promise<DidCommConnectionRecord> {\n    return this.getSingleByQuery(agentContext, { threadId })\n  }\n\n  public getByRoleAndThreadId(\n    agentContext: AgentContext,\n    role: DidCommDidExchangeRole,\n    threadId: string\n  ): Promise<DidCommConnectionRecord> {\n    return this.getSingleByQuery(agentContext, { threadId, role })\n  }\n}\n"],"mappings":";;;;;;;;;AAQO,wCAAM,oCAAoC,WAAoC;CACnF,AAAO,YACL,AAAyC,gBACzC,cACA;AACA,QAAM,yBAAyB,gBAAgB,aAAa;;CAG9D,MAAa,WAAW,cAA4B,EAAE,QAAQ,YAAkD;AAC9G,SAAO,KAAK,kBACV,cACA,EACE,KAAK;GACH;IACE,KAAK;IACL;IACD;GACD;IAAE,KAAK;IAAQ,mBAAmB,CAAC,SAAS;IAAE;GAC9C;IAAE,cAAc,CAAC,OAAO;IAAE;IAAU;GACrC,EACF,EACD,EACE,UAAU,SAAS,OAAO,UAAU,YACrC,CACF;;CAGH,AAAO,cAAc,cAA4B,UAAoD;AACnG,SAAO,KAAK,iBAAiB,cAAc,EAAE,UAAU,CAAC;;CAG1D,AAAO,qBACL,cACA,MACA,UACkC;AAClC,SAAO,KAAK,iBAAiB,cAAc;GAAE;GAAU;GAAM,CAAC;;;;CArCjE,YAAY;oBAGR,OAAO,iBAAiB,eAAe"}