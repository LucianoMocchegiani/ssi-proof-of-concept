{"version":3,"file":"DidCommTrustPingMessageHandler.mjs","names":[],"sources":["../../../../src/modules/connections/handlers/DidCommTrustPingMessageHandler.ts"],"sourcesContent":["import { CredoError } from '@credo-ts/core'\nimport type { DidCommMessageHandler, DidCommMessageHandlerInboundMessage } from '../../../handlers'\nimport { DidCommTrustPingMessage } from '../messages'\nimport { DidCommDidExchangeState } from '../models'\nimport type { DidCommConnectionService, DidCommTrustPingService } from '../services'\n\nexport class DidCommTrustPingMessageHandler implements DidCommMessageHandler {\n  private trustPingService: DidCommTrustPingService\n  private connectionService: DidCommConnectionService\n  public supportedMessages = [DidCommTrustPingMessage]\n\n  public constructor(trustPingService: DidCommTrustPingService, connectionService: DidCommConnectionService) {\n    this.trustPingService = trustPingService\n    this.connectionService = connectionService\n  }\n\n  public async handle(messageContext: DidCommMessageHandlerInboundMessage<DidCommTrustPingMessageHandler>) {\n    const { connection, recipientKey } = messageContext\n    if (!connection) {\n      throw new CredoError(`Connection for verkey ${recipientKey?.fingerprint} not found!`)\n    }\n\n    // TODO: This is better addressed in a middleware of some kind because\n    // any message can transition the state to complete, not just an ack or trust ping\n    if (connection.state === DidCommDidExchangeState.ResponseSent) {\n      await this.connectionService.updateState(\n        messageContext.agentContext,\n        connection,\n        DidCommDidExchangeState.Completed\n      )\n    }\n\n    return this.trustPingService.processPing(messageContext, connection)\n  }\n}\n"],"mappings":";;;;;;;AAMA,IAAa,iCAAb,MAA6E;CAK3E,AAAO,YAAY,kBAA2C,mBAA6C;OAFpG,oBAAoB,CAAC,wBAAwB;AAGlD,OAAK,mBAAmB;AACxB,OAAK,oBAAoB;;CAG3B,MAAa,OAAO,gBAAqF;EACvG,MAAM,EAAE,YAAY,iBAAiB;AACrC,MAAI,CAAC,WACH,OAAM,IAAI,WAAW,yBAAyB,cAAc,YAAY,aAAa;AAKvF,MAAI,WAAW,UAAU,wBAAwB,aAC/C,OAAM,KAAK,kBAAkB,YAC3B,eAAe,cACf,YACA,wBAAwB,UACzB;AAGH,SAAO,KAAK,iBAAiB,YAAY,gBAAgB,WAAW"}