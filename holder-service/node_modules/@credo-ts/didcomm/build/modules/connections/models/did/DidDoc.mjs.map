{"version":3,"file":"DidDoc.mjs","names":[],"sources":["../../../../../src/modules/connections/models/did/DidDoc.ts"],"sourcesContent":["import type { DidDocumentService } from '@credo-ts/core'\nimport { DID_V1_CONTEXT_URL, DidCommV1Service, IndyAgentService, ServiceTransformer } from '@credo-ts/core'\nimport { Expose } from 'class-transformer'\nimport { Equals, IsArray, IsString, ValidateNested } from 'class-validator'\nimport type { Authentication } from './authentication'\nimport { AuthenticationTransformer } from './authentication'\nimport type { PublicKey } from './publicKey'\nimport { PublicKeyTransformer } from './publicKey'\n\ntype DidDocOptions = Pick<DidDoc, 'id' | 'publicKey' | 'service' | 'authentication'>\n\nexport class DidDoc {\n  @Expose({ name: '@context' })\n  @Equals('https://www.w3.org/ns/did/v1')\n  public context = DID_V1_CONTEXT_URL\n\n  @IsString()\n  public id!: string\n\n  @IsArray()\n  @ValidateNested()\n  @PublicKeyTransformer()\n  public publicKey: PublicKey[] = []\n\n  @IsArray()\n  @ValidateNested()\n  @ServiceTransformer()\n  public service: DidDocumentService[] = []\n\n  @IsArray()\n  @ValidateNested()\n  @AuthenticationTransformer()\n  public authentication: Authentication[] = []\n\n  public constructor(options: DidDocOptions) {\n    if (options) {\n      this.id = options.id\n      this.publicKey = options.publicKey\n      this.service = options.service\n      this.authentication = options.authentication\n    }\n  }\n\n  /**\n   * Gets the matching public key for a given key id\n   *\n   * @param id fully qualified key id\n   */\n  public getPublicKey(id: string): PublicKey | undefined {\n    return this.publicKey.find((item) => item.id === id)\n  }\n\n  /**\n   * Returns all of the service endpoints matching the given type.\n   *\n   * @param type The type of service(s) to query.\n   */\n  public getServicesByType<S extends DidDocumentService = DidDocumentService>(type: string): S[] {\n    return this.service.filter((service) => service.type === type) as S[]\n  }\n\n  /**\n   * Returns all of the service endpoints matching the given class\n   *\n   * @param classType The class to query services.\n   */\n  public getServicesByClassType<S extends DidDocumentService = DidDocumentService>(\n    classType: new (...args: never[]) => S\n  ): S[] {\n    return this.service.filter((service) => service instanceof classType) as S[]\n  }\n\n  /**\n   * Get all DIDComm services ordered by priority descending. This means the highest\n   * priority will be the first entry.\n   */\n  public get didCommServices(): Array<IndyAgentService | DidCommV1Service> {\n    const didCommServiceTypes = [IndyAgentService.type, DidCommV1Service.type]\n    const services = this.service.filter((service) => didCommServiceTypes.includes(service.type)) as Array<\n      IndyAgentService | DidCommV1Service\n    >\n\n    // Sort services based on indicated priority\n    return services.sort((a, b) => a.priority - b.priority)\n  }\n}\n"],"mappings":";;;;;;;;;AAWA,IAAa,SAAb,MAAoB;CAuBlB,AAAO,YAAY,SAAwB;OApBpC,UAAU;OAQV,YAAyB,EAAE;OAK3B,UAAgC,EAAE;OAKlC,iBAAmC,EAAE;AAG1C,MAAI,SAAS;AACX,QAAK,KAAK,QAAQ;AAClB,QAAK,YAAY,QAAQ;AACzB,QAAK,UAAU,QAAQ;AACvB,QAAK,iBAAiB,QAAQ;;;;;;;;CASlC,AAAO,aAAa,IAAmC;AACrD,SAAO,KAAK,UAAU,MAAM,SAAS,KAAK,OAAO,GAAG;;;;;;;CAQtD,AAAO,kBAAqE,MAAmB;AAC7F,SAAO,KAAK,QAAQ,QAAQ,YAAY,QAAQ,SAAS,KAAK;;;;;;;CAQhE,AAAO,uBACL,WACK;AACL,SAAO,KAAK,QAAQ,QAAQ,YAAY,mBAAmB,UAAU;;;;;;CAOvE,IAAW,kBAA8D;EACvE,MAAM,sBAAsB,CAAC,iBAAiB,MAAM,iBAAiB,KAAK;AAM1E,SALiB,KAAK,QAAQ,QAAQ,YAAY,oBAAoB,SAAS,QAAQ,KAAK,CAAC,CAK7E,MAAM,GAAG,MAAM,EAAE,WAAW,EAAE,SAAS;;;;CAvExD,OAAO,EAAE,MAAM,YAAY,CAAC;CAC5B,OAAO,+BAA+B;;;YAGtC,UAAU;;CAGV,SAAS;CACT,gBAAgB;CAChB,sBAAsB;;;;CAGtB,SAAS;CACT,gBAAgB;CAChB,oBAAoB;;;;CAGpB,SAAS;CACT,gBAAgB;CAChB,2BAA2B"}