{"version":3,"file":"DidCommConnectionsModule.mjs","names":[],"sources":["../../../src/modules/connections/DidCommConnectionsModule.ts"],"sourcesContent":["import {\n  type AgentContext,\n  type DependencyManager,\n  DidRepository,\n  DidResolverService,\n  type Module,\n} from '@credo-ts/core'\nimport { DidCommFeatureRegistry } from '../../DidCommFeatureRegistry'\nimport { DidCommMessageHandlerRegistry } from '../../DidCommMessageHandlerRegistry'\nimport { DidCommProtocol } from '../../models'\nimport { DidCommOutOfBandService } from '../oob/DidCommOutOfBandService'\nimport { DidCommRoutingService } from '../routing/services/DidCommRoutingService'\nimport { DidCommConnectionsApi } from './DidCommConnectionsApi'\nimport type { DidCommConnectionsModuleConfigOptions } from './DidCommConnectionsModuleConfig'\nimport { DidCommConnectionsModuleConfig } from './DidCommConnectionsModuleConfig'\nimport { DidExchangeProtocol } from './DidExchangeProtocol'\nimport {\n  DidCommAckMessageHandler,\n  DidCommConnectionProblemReportHandler,\n  DidCommConnectionRequestHandler,\n  DidCommConnectionResponseHandler,\n  DidCommDidExchangeCompleteHandler,\n  DidCommDidExchangeRequestHandler,\n  DidCommDidExchangeResponseHandler,\n  DidCommDidRotateAckHandler,\n  DidCommDidRotateHandler,\n  DidCommDidRotateProblemReportHandler,\n  DidCommHangupHandler,\n  DidCommTrustPingMessageHandler,\n  DidCommTrustPingResponseMessageHandler,\n} from './handlers'\nimport { DidCommConnectionRole, DidCommDidExchangeRole, DidCommDidRotateRole } from './models'\nimport { DidCommConnectionRepository } from './repository'\nimport { DidCommConnectionService } from './services/DidCommConnectionService'\nimport { DidCommDidRotateService } from './services/DidCommDidRotateService'\nimport { DidCommTrustPingService } from './services/DidCommTrustPingService'\n\nexport class DidCommConnectionsModule implements Module {\n  public readonly config: DidCommConnectionsModuleConfig\n  public readonly api = DidCommConnectionsApi\n\n  public constructor(config?: DidCommConnectionsModuleConfigOptions) {\n    this.config = new DidCommConnectionsModuleConfig(config)\n  }\n\n  /**\n   * Registers the dependencies of the connections module on the dependency manager.\n   */\n  public register(dependencyManager: DependencyManager) {\n    // Config\n    dependencyManager.registerInstance(DidCommConnectionsModuleConfig, this.config)\n\n    // Services\n    dependencyManager.registerSingleton(DidCommConnectionService)\n    dependencyManager.registerSingleton(DidExchangeProtocol)\n    dependencyManager.registerSingleton(DidCommDidRotateService)\n    dependencyManager.registerSingleton(DidCommTrustPingService)\n\n    // Repositories\n    dependencyManager.registerSingleton(DidCommConnectionRepository)\n  }\n\n  public async initialize(agentContext: AgentContext): Promise<void> {\n    // Features\n    const featureRegistry = agentContext.resolve(DidCommFeatureRegistry)\n    const messageHandlerRegistry = agentContext.resolve(DidCommMessageHandlerRegistry)\n\n    const connectionService = agentContext.resolve(DidCommConnectionService)\n    const outOfBandService = agentContext.resolve(DidCommOutOfBandService)\n    const routingService = agentContext.resolve(DidCommRoutingService)\n    const didRepository = agentContext.resolve(DidRepository)\n    const didResolverService = agentContext.resolve(DidResolverService)\n    const trustPingService = agentContext.resolve(DidCommTrustPingService)\n    const didExchangeProtocol = agentContext.resolve(DidExchangeProtocol)\n    const didRotateService = agentContext.resolve(DidCommDidRotateService)\n\n    messageHandlerRegistry.registerMessageHandler(\n      new DidCommConnectionRequestHandler(\n        connectionService,\n        outOfBandService,\n        routingService,\n        didRepository,\n        this.config\n      )\n    )\n    messageHandlerRegistry.registerMessageHandler(\n      new DidCommConnectionResponseHandler(connectionService, outOfBandService, didResolverService, this.config)\n    )\n    messageHandlerRegistry.registerMessageHandler(new DidCommAckMessageHandler(connectionService))\n    messageHandlerRegistry.registerMessageHandler(new DidCommConnectionProblemReportHandler(connectionService))\n    messageHandlerRegistry.registerMessageHandler(\n      new DidCommTrustPingMessageHandler(trustPingService, connectionService)\n    )\n    messageHandlerRegistry.registerMessageHandler(new DidCommTrustPingResponseMessageHandler(trustPingService))\n    messageHandlerRegistry.registerMessageHandler(\n      new DidCommDidExchangeRequestHandler(\n        didExchangeProtocol,\n        outOfBandService,\n        routingService,\n        didRepository,\n        this.config\n      )\n    )\n    messageHandlerRegistry.registerMessageHandler(\n      new DidCommDidExchangeResponseHandler(\n        didExchangeProtocol,\n        outOfBandService,\n        connectionService,\n        didResolverService,\n        this.config\n      )\n    )\n    messageHandlerRegistry.registerMessageHandler(\n      new DidCommDidExchangeCompleteHandler(didExchangeProtocol, outOfBandService)\n    )\n    messageHandlerRegistry.registerMessageHandler(new DidCommDidRotateHandler(didRotateService))\n    messageHandlerRegistry.registerMessageHandler(new DidCommDidRotateAckHandler(didRotateService))\n    messageHandlerRegistry.registerMessageHandler(new DidCommHangupHandler(didRotateService))\n    messageHandlerRegistry.registerMessageHandler(new DidCommDidRotateProblemReportHandler(didRotateService))\n\n    featureRegistry.register(\n      new DidCommProtocol({\n        id: 'https://didcomm.org/connections/1.0',\n        roles: [DidCommConnectionRole.Invitee, DidCommConnectionRole.Inviter],\n      }),\n      new DidCommProtocol({\n        id: 'https://didcomm.org/didexchange/1.1',\n        roles: [DidCommDidExchangeRole.Requester, DidCommDidExchangeRole.Responder],\n      }),\n      new DidCommProtocol({\n        id: 'https://didcomm.org/did-rotate/1.0',\n        roles: [DidCommDidRotateRole.RotatingParty, DidCommDidRotateRole.ObservingParty],\n      })\n    )\n  }\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAqCA,IAAa,2BAAb,MAAwD;CAItD,AAAO,YAAY,QAAgD;OAFnD,MAAM;AAGpB,OAAK,SAAS,IAAI,+BAA+B,OAAO;;;;;CAM1D,AAAO,SAAS,mBAAsC;AAEpD,oBAAkB,iBAAiB,gCAAgC,KAAK,OAAO;AAG/E,oBAAkB,kBAAkB,yBAAyB;AAC7D,oBAAkB,kBAAkB,oBAAoB;AACxD,oBAAkB,kBAAkB,wBAAwB;AAC5D,oBAAkB,kBAAkB,wBAAwB;AAG5D,oBAAkB,kBAAkB,4BAA4B;;CAGlE,MAAa,WAAW,cAA2C;EAEjE,MAAM,kBAAkB,aAAa,QAAQ,uBAAuB;EACpE,MAAM,yBAAyB,aAAa,QAAQ,8BAA8B;EAElF,MAAM,oBAAoB,aAAa,QAAQ,yBAAyB;EACxE,MAAM,mBAAmB,aAAa,QAAQ,wBAAwB;EACtE,MAAM,iBAAiB,aAAa,QAAQ,sBAAsB;EAClE,MAAM,gBAAgB,aAAa,QAAQ,cAAc;EACzD,MAAM,qBAAqB,aAAa,QAAQ,mBAAmB;EACnE,MAAM,mBAAmB,aAAa,QAAQ,wBAAwB;EACtE,MAAM,sBAAsB,aAAa,QAAQ,oBAAoB;EACrE,MAAM,mBAAmB,aAAa,QAAQ,wBAAwB;AAEtE,yBAAuB,uBACrB,IAAI,gCACF,mBACA,kBACA,gBACA,eACA,KAAK,OACN,CACF;AACD,yBAAuB,uBACrB,IAAI,iCAAiC,mBAAmB,kBAAkB,oBAAoB,KAAK,OAAO,CAC3G;AACD,yBAAuB,uBAAuB,IAAI,yBAAyB,kBAAkB,CAAC;AAC9F,yBAAuB,uBAAuB,IAAI,sCAAsC,kBAAkB,CAAC;AAC3G,yBAAuB,uBACrB,IAAI,+BAA+B,kBAAkB,kBAAkB,CACxE;AACD,yBAAuB,uBAAuB,IAAI,uCAAuC,iBAAiB,CAAC;AAC3G,yBAAuB,uBACrB,IAAI,iCACF,qBACA,kBACA,gBACA,eACA,KAAK,OACN,CACF;AACD,yBAAuB,uBACrB,IAAI,kCACF,qBACA,kBACA,mBACA,oBACA,KAAK,OACN,CACF;AACD,yBAAuB,uBACrB,IAAI,kCAAkC,qBAAqB,iBAAiB,CAC7E;AACD,yBAAuB,uBAAuB,IAAI,wBAAwB,iBAAiB,CAAC;AAC5F,yBAAuB,uBAAuB,IAAI,2BAA2B,iBAAiB,CAAC;AAC/F,yBAAuB,uBAAuB,IAAI,qBAAqB,iBAAiB,CAAC;AACzF,yBAAuB,uBAAuB,IAAI,qCAAqC,iBAAiB,CAAC;AAEzG,kBAAgB,SACd,IAAI,gBAAgB;GAClB,IAAI;GACJ,OAAO,CAAC,sBAAsB,SAAS,sBAAsB,QAAQ;GACtE,CAAC,EACF,IAAI,gBAAgB;GAClB,IAAI;GACJ,OAAO,CAAC,uBAAuB,WAAW,uBAAuB,UAAU;GAC5E,CAAC,EACF,IAAI,gBAAgB;GAClB,IAAI;GACJ,OAAO,CAAC,qBAAqB,eAAe,qBAAqB,eAAe;GACjF,CAAC,CACH"}