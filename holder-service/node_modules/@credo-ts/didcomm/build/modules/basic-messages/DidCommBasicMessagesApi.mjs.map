{"version":3,"file":"DidCommBasicMessagesApi.mjs","names":[],"sources":["../../../src/modules/basic-messages/DidCommBasicMessagesApi.ts"],"sourcesContent":["import type { Query, QueryOptions } from '@credo-ts/core'\nimport { AgentContext, injectable } from '@credo-ts/core'\nimport { DidCommMessageSender } from '../../DidCommMessageSender'\nimport { DidCommOutboundMessageContext } from '../../models'\nimport { DidCommConnectionService } from '../connections/services'\nimport type { DidCommBasicMessageRecord } from './repository/DidCommBasicMessageRecord'\nimport { DidCommBasicMessageService } from './services'\n\n@injectable()\nexport class DidCommBasicMessagesApi {\n  private basicMessageService: DidCommBasicMessageService\n  private messageSender: DidCommMessageSender\n  private connectionService: DidCommConnectionService\n  private agentContext: AgentContext\n\n  public constructor(\n    basicMessageService: DidCommBasicMessageService,\n    messageSender: DidCommMessageSender,\n    connectionService: DidCommConnectionService,\n    agentContext: AgentContext\n  ) {\n    this.basicMessageService = basicMessageService\n    this.messageSender = messageSender\n    this.connectionService = connectionService\n    this.agentContext = agentContext\n  }\n\n  /**\n   * Send a message to an active connection\n   *\n   * @param connectionId Connection Id\n   * @param message Message contents\n   * @throws {RecordNotFoundError} If connection is not found\n   * @throws {MessageSendingError} If message is undeliverable\n   * @returns the created record\n   */\n  public async sendMessage(connectionId: string, message: string, parentThreadId?: string) {\n    const connection = await this.connectionService.getById(this.agentContext, connectionId)\n\n    const { message: basicMessage, record: basicMessageRecord } = await this.basicMessageService.createMessage(\n      this.agentContext,\n      message,\n      connection,\n      parentThreadId\n    )\n    const outboundMessageContext = new DidCommOutboundMessageContext(basicMessage, {\n      agentContext: this.agentContext,\n      connection,\n      associatedRecord: basicMessageRecord,\n    })\n\n    await this.messageSender.sendMessage(outboundMessageContext)\n    return basicMessageRecord\n  }\n\n  /**\n   * Retrieve all basic messages matching a given query\n   *\n   * @param query The query\n   * @param queryOptions The query options\n   * @returns array containing all matching records\n   */\n  public async findAllByQuery(query: Query<DidCommBasicMessageRecord>, queryOptions?: QueryOptions) {\n    return this.basicMessageService.findAllByQuery(this.agentContext, query, queryOptions)\n  }\n\n  /**\n   * Retrieve a basic message record by id\n   *\n   * @param basicMessageRecordId The basic message record id\n   * @throws {RecordNotFoundError} If no record is found\n   * @return The basic message record\n   *\n   */\n  public async getById(basicMessageRecordId: string) {\n    return this.basicMessageService.getById(this.agentContext, basicMessageRecordId)\n  }\n\n  /**\n   * Retrieve a basic message record by thread id\n   *\n   * @param threadId The thread id\n   * @throws {RecordNotFoundError} If no record is found\n   * @throws {RecordDuplicateError} If multiple records are found\n   * @returns The connection record\n   */\n  public async getByThreadId(basicMessageRecordId: string) {\n    return this.basicMessageService.getByThreadId(this.agentContext, basicMessageRecordId)\n  }\n\n  /**\n   * Delete a basic message record by id\n   *\n   * @param connectionId the basic message record id\n   * @throws {RecordNotFoundError} If no record is found\n   */\n  public async deleteById(basicMessageRecordId: string) {\n    await this.basicMessageService.deleteById(this.agentContext, basicMessageRecordId)\n  }\n}\n"],"mappings":";;;;;;;;;;;;;AASO,oCAAM,wBAAwB;CAMnC,AAAO,YACL,qBACA,eACA,mBACA,cACA;AACA,OAAK,sBAAsB;AAC3B,OAAK,gBAAgB;AACrB,OAAK,oBAAoB;AACzB,OAAK,eAAe;;;;;;;;;;;CAYtB,MAAa,YAAY,cAAsB,SAAiB,gBAAyB;EACvF,MAAM,aAAa,MAAM,KAAK,kBAAkB,QAAQ,KAAK,cAAc,aAAa;EAExF,MAAM,EAAE,SAAS,cAAc,QAAQ,uBAAuB,MAAM,KAAK,oBAAoB,cAC3F,KAAK,cACL,SACA,YACA,eACD;EACD,MAAM,yBAAyB,IAAI,8BAA8B,cAAc;GAC7E,cAAc,KAAK;GACnB;GACA,kBAAkB;GACnB,CAAC;AAEF,QAAM,KAAK,cAAc,YAAY,uBAAuB;AAC5D,SAAO;;;;;;;;;CAUT,MAAa,eAAe,OAAyC,cAA6B;AAChG,SAAO,KAAK,oBAAoB,eAAe,KAAK,cAAc,OAAO,aAAa;;;;;;;;;;CAWxF,MAAa,QAAQ,sBAA8B;AACjD,SAAO,KAAK,oBAAoB,QAAQ,KAAK,cAAc,qBAAqB;;;;;;;;;;CAWlF,MAAa,cAAc,sBAA8B;AACvD,SAAO,KAAK,oBAAoB,cAAc,KAAK,cAAc,qBAAqB;;;;;;;;CASxF,MAAa,WAAW,sBAA8B;AACpD,QAAM,KAAK,oBAAoB,WAAW,KAAK,cAAc,qBAAqB;;;sCAzFrF,YAAY"}