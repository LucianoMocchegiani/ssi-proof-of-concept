{"version":3,"file":"DidCommMessageHandlerMiddleware.mjs","names":[],"sources":["../../src/handlers/DidCommMessageHandlerMiddleware.ts"],"sourcesContent":["import type { DidCommInboundMessageContext } from '../models/DidCommInboundMessageContext'\n\nexport type DidCommMessageHandlerMiddleware = (\n  inboundMessageContext: DidCommInboundMessageContext,\n  next: () => Promise<void>\n) => Promise<void>\n\n// biome-ignore lint/complexity/noStaticOnlyClass: no explanation\nexport class DidCommMessageHandlerMiddlewareRunner {\n  public static async run(\n    middlewares: DidCommMessageHandlerMiddleware[],\n    inboundMessageContext: DidCommInboundMessageContext\n  ) {\n    const compose = (middlewares: DidCommMessageHandlerMiddleware[]) => {\n      return async (inboundMessageContext: DidCommInboundMessageContext) => {\n        let index = -1\n        async function dispatch(i: number): Promise<void> {\n          if (i <= index) throw new Error('next() called multiple times')\n          index = i\n          const fn = middlewares[i]\n          if (!fn) return\n          await fn(inboundMessageContext, () => dispatch(i + 1))\n        }\n        await dispatch(0)\n      }\n    }\n\n    const composed = compose(middlewares)\n    await composed(inboundMessageContext)\n  }\n}\n"],"mappings":";AAQA,IAAa,wCAAb,MAAmD;CACjD,aAAoB,IAClB,aACA,uBACA;EACA,MAAM,WAAW,gBAAmD;AAClE,UAAO,OAAO,0BAAwD;IACpE,IAAI,QAAQ;IACZ,eAAe,SAAS,GAA0B;AAChD,SAAI,KAAK,MAAO,OAAM,IAAI,MAAM,+BAA+B;AAC/D,aAAQ;KACR,MAAM,KAAK,YAAY;AACvB,SAAI,CAAC,GAAI;AACT,WAAM,GAAG,6BAA6B,SAAS,IAAI,EAAE,CAAC;;AAExD,UAAM,SAAS,EAAE;;;AAKrB,QADiB,QAAQ,YAAY,CACtB,sBAAsB"}