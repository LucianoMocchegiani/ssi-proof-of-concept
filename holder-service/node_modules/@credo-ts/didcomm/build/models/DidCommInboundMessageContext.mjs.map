{"version":3,"file":"DidCommInboundMessageContext.mjs","names":[],"sources":["../../src/models/DidCommInboundMessageContext.ts"],"sourcesContent":["import type { AgentContext, Kms } from '@credo-ts/core'\nimport { CredoError } from '@credo-ts/core'\nimport type { DidCommMessage } from '../DidCommMessage'\nimport type { DidCommMessageHandler } from '../handlers'\nimport type { DidCommConnectionRecord } from '../modules/connections/repository'\nimport type { DidCommEncryptedMessage } from '../types'\nimport type { DidCommOutboundMessageContext } from './DidCommOutboundMessageContext'\n\nexport interface MessageContextParams {\n  connection?: DidCommConnectionRecord\n  sessionId?: string\n  senderKey?: Kms.PublicJwk<Kms.Ed25519PublicJwk>\n  recipientKey?: Kms.PublicJwk<Kms.Ed25519PublicJwk>\n  agentContext: AgentContext\n  receivedAt?: Date\n  encryptedMessage?: DidCommEncryptedMessage\n}\n\nexport class DidCommInboundMessageContext<T extends DidCommMessage = DidCommMessage> {\n  public connection?: DidCommConnectionRecord\n  public sessionId?: string\n  public senderKey?: Kms.PublicJwk<Kms.Ed25519PublicJwk>\n  public recipientKey?: Kms.PublicJwk<Kms.Ed25519PublicJwk>\n  public receivedAt: Date\n\n  public readonly agentContext: AgentContext\n\n  public message: T\n  public messageHandler?: DidCommMessageHandler\n  public responseMessage?: DidCommOutboundMessageContext\n  public encryptedMessage?: DidCommEncryptedMessage\n\n  public constructor(message: T, context: MessageContextParams) {\n    this.message = message\n    this.recipientKey = context.recipientKey\n    this.senderKey = context.senderKey\n    this.connection = context.connection\n    this.sessionId = context.sessionId\n    this.agentContext = context.agentContext\n    this.receivedAt = context.receivedAt ?? new Date()\n    this.encryptedMessage = context.encryptedMessage\n  }\n\n  public setMessageHandler(messageHandler: DidCommMessageHandler) {\n    this.messageHandler = messageHandler\n  }\n\n  public setResponseMessage(outboundMessageContext: DidCommOutboundMessageContext) {\n    this.responseMessage = outboundMessageContext\n  }\n\n  /**\n   * Assert the inbound message has a ready connection associated with it.\n   *\n   * @throws {CredoError} if there is no connection or the connection is not ready\n   */\n  public assertReadyConnection(): DidCommConnectionRecord {\n    if (!this.connection) {\n      throw new CredoError(`No connection associated with incoming message ${this.message.type}`)\n    }\n\n    // Make sure connection is ready\n    this.connection.assertReady()\n\n    return this.connection\n  }\n\n  public toJSON() {\n    return {\n      message: this.message,\n      recipientKey: this.recipientKey?.fingerprint,\n      senderKey: this.senderKey?.fingerprint,\n      sessionId: this.sessionId,\n      agentContext: this.agentContext.toJSON(),\n    }\n  }\n}\n"],"mappings":";;;AAkBA,IAAa,+BAAb,MAAqF;CAcnF,AAAO,YAAY,SAAY,SAA+B;AAC5D,OAAK,UAAU;AACf,OAAK,eAAe,QAAQ;AAC5B,OAAK,YAAY,QAAQ;AACzB,OAAK,aAAa,QAAQ;AAC1B,OAAK,YAAY,QAAQ;AACzB,OAAK,eAAe,QAAQ;AAC5B,OAAK,aAAa,QAAQ,8BAAc,IAAI,MAAM;AAClD,OAAK,mBAAmB,QAAQ;;CAGlC,AAAO,kBAAkB,gBAAuC;AAC9D,OAAK,iBAAiB;;CAGxB,AAAO,mBAAmB,wBAAuD;AAC/E,OAAK,kBAAkB;;;;;;;CAQzB,AAAO,wBAAiD;AACtD,MAAI,CAAC,KAAK,WACR,OAAM,IAAI,WAAW,kDAAkD,KAAK,QAAQ,OAAO;AAI7F,OAAK,WAAW,aAAa;AAE7B,SAAO,KAAK;;CAGd,AAAO,SAAS;AACd,SAAO;GACL,SAAS,KAAK;GACd,cAAc,KAAK,cAAc;GACjC,WAAW,KAAK,WAAW;GAC3B,WAAW,KAAK;GAChB,cAAc,KAAK,aAAa,QAAQ;GACzC"}