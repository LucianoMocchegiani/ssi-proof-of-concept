{"version":3,"file":"DidCommOutboundMessageContext.mjs","names":[],"sources":["../../src/models/DidCommOutboundMessageContext.ts"],"sourcesContent":["import type { AgentContext, BaseRecord, Kms, ResolvedDidCommService } from '@credo-ts/core'\nimport { CredoError } from '@credo-ts/core'\nimport type { DidCommMessage } from '../DidCommMessage'\nimport type { DidCommConnectionRecord } from '../modules/connections/repository'\nimport type { DidCommOutOfBandRecord } from '../modules/oob'\nimport type { DidCommInboundMessageContext } from './DidCommInboundMessageContext'\n\nexport interface ServiceMessageParams {\n  senderKey: Kms.PublicJwk<Kms.Ed25519PublicJwk>\n  service: ResolvedDidCommService\n  returnRoute?: boolean\n}\n\nexport interface DidCommOutboundMessageContextParams {\n  agentContext: AgentContext\n  inboundMessageContext?: DidCommInboundMessageContext\n  // biome-ignore lint/suspicious/noExplicitAny: no explanation\n  associatedRecord?: BaseRecord<any, any, any>\n  connection?: DidCommConnectionRecord\n  serviceParams?: ServiceMessageParams\n  outOfBand?: DidCommOutOfBandRecord\n  sessionId?: string\n}\n\nexport class DidCommOutboundMessageContext<T extends DidCommMessage = DidCommMessage> {\n  public message: T\n  public connection?: DidCommConnectionRecord\n  public serviceParams?: ServiceMessageParams\n  public outOfBand?: DidCommOutOfBandRecord\n  // biome-ignore lint/suspicious/noExplicitAny: no explanation\n  public associatedRecord?: BaseRecord<any, any, any>\n  public sessionId?: string\n  public inboundMessageContext?: DidCommInboundMessageContext\n  public readonly agentContext: AgentContext\n\n  public constructor(message: T, context: DidCommOutboundMessageContextParams) {\n    this.message = message\n    this.connection = context.connection\n    this.sessionId = context.sessionId\n    this.outOfBand = context.outOfBand\n    this.serviceParams = context.serviceParams\n    this.associatedRecord = context.associatedRecord\n    this.inboundMessageContext = context.inboundMessageContext\n    this.agentContext = context.agentContext\n  }\n\n  /**\n   * Assert the outbound message has a ready connection associated with it.\n   *\n   * @throws {CredoError} if there is no connection or the connection is not ready\n   */\n  public assertReadyConnection(): DidCommConnectionRecord {\n    if (!this.connection) {\n      throw new CredoError(`No connection associated with outgoing message ${this.message.type}`)\n    }\n\n    // Make sure connection is ready\n    this.connection.assertReady()\n\n    return this.connection\n  }\n\n  public isOutboundServiceMessage(): boolean {\n    return this.serviceParams?.service !== undefined\n  }\n\n  public toJSON() {\n    return {\n      message: this.message,\n      outOfBand: this.outOfBand,\n      associatedRecord: this.associatedRecord,\n      sessionId: this.sessionId,\n      serviceParams: this.serviceParams,\n      agentContext: this.agentContext.toJSON(),\n      connection: this.connection,\n    }\n  }\n}\n"],"mappings":";;;AAwBA,IAAa,gCAAb,MAAsF;CAWpF,AAAO,YAAY,SAAY,SAA8C;AAC3E,OAAK,UAAU;AACf,OAAK,aAAa,QAAQ;AAC1B,OAAK,YAAY,QAAQ;AACzB,OAAK,YAAY,QAAQ;AACzB,OAAK,gBAAgB,QAAQ;AAC7B,OAAK,mBAAmB,QAAQ;AAChC,OAAK,wBAAwB,QAAQ;AACrC,OAAK,eAAe,QAAQ;;;;;;;CAQ9B,AAAO,wBAAiD;AACtD,MAAI,CAAC,KAAK,WACR,OAAM,IAAI,WAAW,kDAAkD,KAAK,QAAQ,OAAO;AAI7F,OAAK,WAAW,aAAa;AAE7B,SAAO,KAAK;;CAGd,AAAO,2BAAoC;AACzC,SAAO,KAAK,eAAe,YAAY;;CAGzC,AAAO,SAAS;AACd,SAAO;GACL,SAAS,KAAK;GACd,WAAW,KAAK;GAChB,kBAAkB,KAAK;GACvB,WAAW,KAAK;GAChB,eAAe,KAAK;GACpB,cAAc,KAAK,aAAa,QAAQ;GACxC,YAAY,KAAK;GAClB"}